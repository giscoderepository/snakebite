System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"],(function(e){var t,o,a,n,i,s;return{setters:[function(e){t=e},function(e){o=e},function(e){a=e},function(e){n=e},function(e){i=e},function(e){s=e}],execute:function(){e(function(e){var t={};function o(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=180)}({0:function(e,o){e.exports=t},1:function(e,t){e.exports=o},107:function(e,t){e.exports='<svg viewBox="0 0 12 40" xmlns="http://www.w3.org/2000/svg"><path d="M6 30v10H0v-1h5v-9h1zM3.162 18.582a.5.5 0 010 .71l-1.416 1.421a2.497 2.497 0 00-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 01.712.713L6 24.968a3.502 3.502 0 01-4.967 0 3.501 3.501 0 010-4.967l1.416-1.422a.504.504 0 01.713.003zm4.967-.71a.5.5 0 010 .71L4.58 22.129a.504.504 0 01-.713-.712l3.548-3.548a.504.504 0 01.713.003zm2.838-2.838a3.501 3.501 0 010 4.967l-1.42 1.419a.504.504 0 01-.713-.712l1.423-1.417a2.5 2.5 0 000-3.547 2.502 2.502 0 00-3.547 0l-1.42 1.419a.504.504 0 01-.713-.712l1.42-1.42a3.506 3.506 0 014.97.003zM6 0v10H5V1H0V0h6z" fill="#A8A8A8" fill-rule="evenodd"></path></svg>'},12:function(e,t){e.exports=i},180:function(e,t,o){"use strict";o.r(t);var a,n,i=o(0),s=o(1),r=o(2),c=o(12),u=o(3),l=o(42),p=o(21),d=o(57),g=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),S=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},m=Object(i.Immutable)([c.AllDataSourceTypes.FeatureLayer,c.AllDataSourceTypes.SceneLayer]),f=function(e){function t(t){var o=e.call(this,t)||this;return o.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},o.initOutputDataSources=function(e){var t,o=null!==(t=null==e?void 0:e.map((function(e){return{dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}})))&&void 0!==t?t:[];return Object(i.Immutable)(o)},o.getInitConfig=function(){var e=o.props.messageWidgetId,t=Object(i.getAppStore)().getState().appStateInBuilder.appConfig,a=t.widgets[e],n=null,s=null;if(o.props.config.messageUseDataSource)n=o.checkAndGetInitUseDataSource(o.props.messageWidgetId,o.props.config.messageUseDataSource);else{var r=d.a(e,o.props.messageType)?o.initOutputDataSources(null==a?void 0:a.outputDataSources):null==a?void 0:a.useDataSources;if((null==r?void 0:r[0])&&1===(null==r?void 0:r.length))n=!(c=t.dataSources[r[0].dataSourceId])||c.type!==u.ArcGISDataSourceTypes.WebMap&&c.type!==u.ArcGISDataSourceTypes.WebScene?Object(i.Immutable)({dataSourceId:r[0].dataSourceId,mainDataSourceId:r[0].mainDataSourceId,dataViewId:r[0].dataViewId,rootDataSourceId:r[0].rootDataSourceId}):null}var c,l=o.props.widgetId,p=t.widgets[l];o.props.config.actionUseDataSource?s=o.checkAndGetInitUseDataSource(o.props.widgetId,o.props.config.actionUseDataSource):p&&p.useDataSources&&p.useDataSources[0]&&1===p.useDataSources.length&&(s=!(c=t.dataSources[p.useDataSources[0].dataSourceId])||c.type!==u.ArcGISDataSourceTypes.WebMap&&c.type!==u.ArcGISDataSourceTypes.WebScene?Object(i.Immutable)({dataSourceId:p.useDataSources[0].dataSourceId,mainDataSourceId:p.useDataSources[0].mainDataSourceId,dataViewId:p.useDataSources[0].dataViewId,rootDataSourceId:p.useDataSources[0].rootDataSourceId}):null);var g=o.props.config.actionUseDataSource&&o.props.config.actionUseDataSource.dataSourceId;return(s&&s.dataSourceId)!==g?{messageUseDataSource:n,actionUseDataSource:s,sqlExprObj:null}:{messageUseDataSource:n,actionUseDataSource:s,sqlExprObj:o.props.config.sqlExprObj}},o.checkAndGetInitUseDataSource=function(e,t){var a,n,s=Object(i.getAppStore)().getState().appStateInBuilder.appConfig,r=s.widgets[e],c=null,l=!1,p=d.a(e,o.props.messageType),g=p?o.initOutputDataSources(null==r?void 0:r.outputDataSources):null==r?void 0:r.useDataSources,S=g&&g[0]&&g[0].dataSourceId;if(!S)return null;var m=s.dataSources[S];if(!m||m.type!==u.ArcGISDataSourceTypes.WebMap&&m.type!==u.ArcGISDataSourceTypes.WebScene||(l=!0),l){var f=!1;if(g)for(var h=0;h<g.length;h++)if(g[h].dataSourceId===t.rootDataSourceId){f=!0;break}c=f?t:null}else{f=!1;if(g)for(h=0;h<g.length;h++){var D=p?null==t?void 0:t.mainDataSourceId:null==t?void 0:t.dataSourceId;if((p?null===(a=g[h])||void 0===a?void 0:a.mainDataSourceId:null===(n=g[h])||void 0===n?void 0:n.dataSourceId)===D){f=!0;break}}c=f?t:1===(null==g?void 0:g.length)?Object(i.Immutable)({dataSourceId:null==g?void 0:g[0].dataSourceId,mainDataSourceId:null==g?void 0:g[0].mainDataSourceId,dataViewId:null==g?void 0:g[0].dataViewId,rootDataSourceId:null==g?void 0:g[0].rootDataSourceId}):null}return c},o.handleTriggerLayerChange=function(e){e&&e.length>0?o.handleTriggerLayerSelected(e[0]):o.handleRemoveLayerForTriggerLayer()},o.handleActionLayerChange=function(e){e&&e.length>0?o.handleActionLayerSelected(e[0]):o.handleRemoveLayerForActionLayer()},o.handleTriggerLayerSelected=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("messageUseDataSource",e)})},o.handleActionLayerSelected=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("actionUseDataSource",e).set("sqlExprObj",null)})},o.handleRemoveLayerForTriggerLayer=function(){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("messageUseDataSource",null)})},o.handleRemoveLayerForActionLayer=function(){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("actionUseDataSource",null).set("sqlExprObj",null)})},o.showSqlExprPopup=function(){o.setState({isSqlExprShow:!0})},o.toggleSqlExprPopup=function(){o.setState({isSqlExprShow:!o.state.isSqlExprShow})},o.onSqlExprBuilderChange=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("sqlExprObj",e)})},o.onMessageFieldSelected=function(e,t){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("messageUseDataSource",{dataSourceId:o.props.config.messageUseDataSource.dataSourceId,mainDataSourceId:o.props.config.messageUseDataSource.mainDataSourceId,dataViewId:o.props.config.messageUseDataSource.dataViewId,rootDataSourceId:o.props.config.messageUseDataSource.rootDataSourceId,fields:e.map((function(e){return e.jimuName}))})})},o.onActionFieldSelected=function(e,t){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("actionUseDataSource",{dataSourceId:o.props.config.actionUseDataSource.dataSourceId,mainDataSourceId:o.props.config.actionUseDataSource.mainDataSourceId,dataViewId:o.props.config.actionUseDataSource.dataViewId,rootDataSourceId:o.props.config.actionUseDataSource.rootDataSourceId,fields:e.map((function(e){return e.jimuName}))})})},o.swicthEnabledDataRelationShip=function(e){o.props.onSettingChange({actionId:o.props.actionId,config:o.props.config.set("enabledDataRelationShip",e)})},o.checkTrigerLayerIsSameToActionLayer=function(){return!(!o.props.config.messageUseDataSource||!o.props.config.actionUseDataSource)&&(o.props.config.messageUseDataSource.mainDataSourceId===o.props.config.actionUseDataSource.mainDataSourceId&&o.props.config.messageUseDataSource.rootDataSourceId===o.props.config.actionUseDataSource.rootDataSourceId)},o.getDsRootIdsByWidgetId=function(e){var t,o,a,n,s=null===(o=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],c=[],l=i.DataSourceManager.getInstance();return null===(n=null==r?void 0:r.useDataSources)||void 0===n||n.forEach((function(e){var t=l.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==u.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==u.ArcGISDataSourceTypes.WebScene||c.push(e.dataSourceId)})),c.length>0?Object(i.Immutable)(c):void 0},o.getDsIdsByWidgetId=function(e){var t,a,n,s,r=null===(a=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,c=null===(n=null==r?void 0:r.widgets)||void 0===n?void 0:n[e],u=d.a(e,o.props.messageType)?o.initOutputDataSources(null==c?void 0:c.outputDataSources):null==c?void 0:c.useDataSources;return Object(i.Immutable)(null!==(s=null==u?void 0:u.map((function(e){return null==e?void 0:e.mainDataSourceId})))&&void 0!==s?s:[])},o.getDsSelectorSourceData=function(e,t){var a,n,s,r=null===(n=null===(a=Object(i.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===n?void 0:n.appConfig,c=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[e],u=!1,l=o.getDsRootIdsByWidgetId(e);l&&0===l.length&&c&&c.useDataSources&&1===c.useDataSources.length&&(u=!0);var p=d.a(e,o.props.messageType)?o.initOutputDataSources(null==c?void 0:c.outputDataSources):null==c?void 0:c.useDataSources;return l||1!==(null==p?void 0:p.length)||(u=!0),{isReadOnly:u,useDataSources:t&&t.dataSourceId?Object(i.Immutable)([t]):Object(i.Immutable)([]),fromRootDsIds:l,fromDsIds:l?void 0:o.getDsIdsByWidgetId(e)}},o.checkIsDisableDataView=function(e){var t,a,n,s;if(o.props.messageType===i.MessageType.DataRecordsSelectionChange)return!0;var r=null===(a=null===(t=Object(i.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,c=null===(n=null==r?void 0:r.widgets)||void 0===n?void 0:n[e];return!!c&&"Map"===(null===(s=null==c?void 0:c.manifest)||void 0===s?void 0:s.label)},o.modalStyle.borderRight="1px solid black",o.modalStyle.borderBottom="1px solid black",o.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1},o}return g(t,e),t.prototype.componentDidMount=function(){var e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj)})},t.prototype.getStyle=function(e){return Object(i.css)(n||(n=S(["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n\n      .sql-expr-display {\n        width: 100%;\n        height: auto;\n        min-height: 60px;\n        line-height: 25px;\n        padding: 3px 5px;\n        color: ",";\n        border: 1px solid ",";\n      }\n\n      .relate-panel-left {\n        flex: auto;\n        .action-select-chooser {\n          margin-top: ",";\n        }\n      }\n    "],["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n\n      .sql-expr-display {\n        width: 100%;\n        height: auto;\n        min-height: 60px;\n        line-height: 25px;\n        padding: 3px 5px;\n        color: ",";\n        border: 1px solid ",";\n      }\n\n      .relate-panel-left {\n        flex: auto;\n        .action-select-chooser {\n          margin-top: ",";\n        }\n      }\n    "])),i.polished.rem(10),i.polished.rem(16),i.polished.rem(0),i.polished.rem(16),e.colors.palette.dark[300],e.colors.palette.light[500],i.polished.rem(12))},t.prototype.render=function(){var e,t,a=this,n=this.props.config.actionUseDataSource&&i.DataSourceManager.getInstance().getDataSource(this.props.config.actionUseDataSource.dataSourceId),u=this.props.theme,d=this.getDsSelectorSourceData(this.props.messageWidgetId,this.props.config.messageUseDataSource),g=this.getDsSelectorSourceData(this.props.widgetId,this.props.config.actionUseDataSource);return Object(i.jsx)("div",{css:this.getStyle(this.props.theme)},Object(i.jsx)(r.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:p.a.mapAction_TriggerLayer})},Object(i.jsx)(c.DataSourceSelector,{types:m,useDataSources:d.useDataSources,fromRootDsIds:d.fromRootDsIds,fromDsIds:d.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:function(){return d.isReadOnly},disableDataSourceList:d.isReadOnly,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})),Object(i.jsx)(r.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_ActionLayer",defaultMessage:p.a.mapAction_ActionLayer})},Object(i.jsx)(c.DataSourceSelector,{types:m,useDataSources:g.useDataSources,fromRootDsIds:g.fromRootDsIds,fromDsIds:g.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:function(){return g.isReadOnly},disableDataSourceList:g.isReadOnly,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),this.props.config&&this.props.config.messageUseDataSource&&this.props.config.actionUseDataSource&&Object(i.jsx)(r.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_Conditions",defaultMessage:p.a.mapAction_Conditions})},Object(i.jsx)(r.SettingRow,{label:this.props.intl.formatMessage({id:"mapAction_RelateMessage",defaultMessage:p.a.mapAction_RelateMessage})},Object(i.jsx)(s.Switch,{checked:this.props.config.enabledDataRelationShip,onChange:function(e){a.swicthEnabledDataRelationShip(e.target.checked)}})),Object(i.jsx)(r.SettingRow,null,Object(i.jsx)(s.Collapse,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},this.checkTrigerLayerIsSameToActionLayer()&&Object(i.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"mapAction_AutoBind",defaultMessage:p.a.mapAction_AutoBind})),!this.checkTrigerLayerIsSameToActionLayer()&&Object(i.jsx)("div",{className:"w-100 d-flex align-items-center"},Object(i.jsx)("div",{className:"d-flex flex-column relate-panel-left"},Object(i.jsx)(c.FieldSelector,{className:"w-100",useDataSources:Object(i.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeHolder:this.props.intl.formatMessage({id:"mapAction_TriggerLayerField",defaultMessage:p.a.mapAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,isSearchInputHidden:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:Object(i.Immutable)([])}),Object(i.jsx)(c.FieldSelector,{className:"w-100 action-select-chooser",placeHolder:this.props.intl.formatMessage({id:"mapAction_ActionLayerField",defaultMessage:p.a.mapAction_ActionLayerField}),useDataSources:Object(i.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,isSearchInputHidden:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:Object(i.Immutable)([])})),Object(i.jsx)(s.Icon,{className:"flex-none",width:12,height:40,color:u.colors.dark[400],icon:o(107)})))),Object(i.jsx)(r.SettingRow,null,Object(i.jsx)(s.Button,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},Object(i.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"mapAction_MoreConditions",defaultMessage:p.a.mapAction_MoreConditions}))),this.props.config.actionUseDataSource&&Object(i.jsx)(i.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(function(e){return Object(i.jsx)(l.SqlExpressionBuilderPopup,{dataSource:e,mode:i.SqlExpressionMode.Simple,isOpen:a.state.isSqlExprShow,toggle:a.toggleSqlExprPopup,expression:a.props.config.sqlExprObj,onChange:function(e){a.onSqlExprBuilderChange(e)}})}))),Object(i.jsx)(r.SettingRow,null,Object(i.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&n?i.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,n).displaySQL:this.props.intl.formatMessage({id:"mapAction_SetExpression",defaultMessage:p.a.mapAction_SetExpression})))))},t.defaultProps={config:Object(i.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})},t}(i.React.PureComponent);t.default=i.themeUtils.withTheme(f)},2:function(e,t){e.exports=a},21:function(e,t,o){"use strict";t.a={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Modify initial view",defaultView:"Default",defaultViewTip:"Initial position of the map inherited from the web map or web scene",customView:"Custom",customViewTip:"Create a new position of the map",customViewSet:"Modify",toolLabel:"Tools",options:"Options",selectionHighlightColor:"Selection highlight",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",sceneQualityMode:"Scene quality mode",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger data",mapAction_SetData:"Select data",mapAction_ActionLayer:"Action data",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select data",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No data.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},3:function(e,t){e.exports=n},42:function(e,t){e.exports=s},57:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var a=o(0);function n(e,t){return function(e,t){var o,n,i,s,r=null===(n=null===(o=Object(a.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===n?void 0:n.appConfig,c=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[e],u=null===(s=null==c?void 0:c.manifest)||void 0===s?void 0:s.publishMessages,l=null;return null==u||u.forEach((function(e){var o=e;(null==o?void 0:o.messageCarryData)&&(null==o?void 0:o.messageType)==t&&(l=null==o?void 0:o.messageCarryData)})),l}(e,t)==a.MessageCarryData.OutputDataSource}}}))}}}));