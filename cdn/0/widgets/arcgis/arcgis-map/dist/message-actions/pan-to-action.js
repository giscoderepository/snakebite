System.register(["jimu-core","jimu-arcgis"],(function(e){var t,r;return{setters:[function(e){t=e},function(e){r=e}],execute:function(){e(function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=173)}({0:function(e,r){e.exports=t},173:function(e,t,r){"use strict";r.r(t);var n,a=r(0),i=r(3),o=r(32),u=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.filterMessageType=function(e,t){return e===a.MessageType.DataRecordSetChange||e===a.MessageType.DataRecordsSelectionChange||e===a.MessageType.ExtentChange},t.prototype.filterMessage=function(e){return!0},t.prototype.getSettingComponentUri=function(e,t){return"Map"===(Object(a.getAppStore)().getState().appStateInBuilder?Object(a.getAppStore)().getState().appStateInBuilder.appConfig:Object(a.getAppStore)().getState().appConfig).widgets[t].manifest.label&&e===a.MessageType.DataRecordsSelectionChange?"message-actions/pan-to-action-setting":null},t.prototype.onExecute=function(e,t){var r=this;return Object(i.loadArcGISJSAPIModules)(["esri/Graphic"]).then((function(n){var i;switch(i=n[0],e.type){case a.MessageType.DataRecordSetChange:var u=e;if(u.changeType===a.RecordSetChangeType.Create||u.changeType===a.RecordSetChangeType.Update){var s={};if(u.dataRecordSet&&u.dataRecordSet.records){for(var c=[],l=0;l<u.dataRecordSet.records.length;l++){(h=u.dataRecordSet.records[l].feature)&&c.push(Object(o.f)(h,i).geometry)}s={features:c}}a.MutableStoreManager.getInstance().updateStateValue(r.widgetId,"panToActionValue.value",s)}break;case a.MessageType.DataRecordsSelectionChange:if(t){var f={},p=[];if((d=e).records){if(d.records[0]&&(!t.useDataSource||d.records[0].dataSource.getMainDataSource().id!==t.useDataSource.mainDataSourceId))break;for(l=0;l<d.records.length;l++){(h=d.records[l].feature)&&p.push(Object(o.f)(h,i).geometry)}}f={features:p},a.MutableStoreManager.getInstance().updateStateValue(r.widgetId,"panToActionValue.value",f);break}var d;f={},p=[];if((d=e).records)for(l=0;l<d.records.length;l++){var h;(h=d.records[l].feature)&&p.push(Object(o.f)(h,i).geometry)}f={features:p},a.MutableStoreManager.getInstance().updateStateValue(r.widgetId,"panToActionValue.value",f);break;case a.MessageType.ExtentChange:var y=e;if(y.getRelatedWidgetIds().includes(r.widgetId))break;var g={value:{features:[y.extent]},relatedWidgets:y.getRelatedWidgetIds()};a.MutableStoreManager.getInstance().updateStateValue(r.widgetId,"panToActionValue",g)}return!0}))},t}(a.AbstractMessageAction);t.default=s},3:function(e,t){e.exports=r},32:function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"l",(function(){return s})),r.d(t,"k",(function(){return l})),r.d(t,"g",(function(){return f})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"f",(function(){return m})),r.d(t,"i",(function(){return b})),r.d(t,"h",(function(){return w})),r.d(t,"a",(function(){return S})),r.d(t,"e",(function(){return M})),r.d(t,"j",(function(){return x}));var n=r(0),a=r(3),i=function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))},o=function(e,t){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function u(e,t){return i(this,void 0,Promise,(function(){var r;return o(this,(function(n){return r=[],t&&Object.keys(t).forEach((function(n){e.map.layers.find((function(e){return e.id===n}))?console.warn("the feature layer is already created"):r.push(c(e,t[n],n))})),0===r.length?[2,null]:[2,Promise.all(r)]}))}))}function s(e,t){return i(this,void 0,Promise,(function(){var r;return o(this,(function(n){return r=[],t&&Object.keys(t).forEach((function(n){var a=e.map.layers.find((function(e){return e.id===n}));a&&(e.map.remove(a),r.push(c(e,t[n],n)))})),0===r.length?[2,null]:[2,Promise.all(r)]}))}))}function c(e,t,r){return i(this,void 0,Promise,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,i){return Object(a.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((function(a){if(t.features.length<1)return n(null);var i=void 0;i=a[0];for(var o=t.features[0].layer,u=[],s={},c=0;c<o.fields.length;c++){var l=(h=o.fields[c],void 0,{name:h.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:h.alias,type:h.type});s[o.fields[c].name]=l.name,u.push(l)}var f=[];for(var p in t.features[0].attributes)if(s[p]){l={fieldName:s[p],label:p};f.push(l)}var d=[];t.features.forEach((function(e,t){var r=e;if(r.attributes){for(var n in r.attributes)r.attributes[s[n]]=r.attributes[n];r.attributes.exbfid=t}else r.attributes={exbfid:t};d.push(r)}));var h,y=new i({id:r,title:o.title,source:d,fields:u,outFields:["*"],objectIdField:"exbfid",renderer:o.renderer,popupEnabled:!0,popupTemplate:{title:"information",content:[{type:"fields",fieldInfos:f}]}});e.map.add(y),y.on("layerview-create",(function(e){return n(null)}))}))}))];case 1:return[2,n.sent()]}}))}))}function l(e,t,r){var n=r,a=null,i=null;if(n||(i=t instanceof Array?t[0]:t)&&(n=i.layer&&i.layer.id),n){for(var o=e.allLayerViews,u=0;u<o.length;u++)o.getItemAt(u).layer.id===n&&(a=o.getItemAt(u));return a?{layerId:n,handle:a.highlight(t)}:null}}function f(e,t){return i(this,void 0,Promise,(function(){var r,n,a,i,u;return o(this,(function(o){switch(o.label){case 0:return n=e,(r=t)instanceof Array?0!==r.length?[3,2]:[4,Promise.resolve()]:[3,6];case 1:return[2,o.sent()];case 2:if(!r[0].geometry)return[3,4];for(a=[],i=0;i<r.length;i++)a.push(r[i].geometry);return[4,p(a).then((function(e){return n.goTo(e.center)}))];case 3:return[2,o.sent()];case 4:return[2,p(r).then((function(e){return n.goTo(e.center)}))];case 5:return[3,7];case 6:return r.geometry?(u=r.geometry,[2,n.goTo(v(u))]):[2,n.goTo(v(r))];case 7:return[2]}}))}))}function p(e){return i(this,void 0,Promise,(function(){var t=this;return o(this,(function(r){switch(r.label){case 0:return[4,Object(a.loadArcGISJSAPIModules)(["esri/geometry/Extent"]).then((function(r){return i(t,void 0,void 0,(function(){var t,n,a,i,u,s,c;return o(this,(function(o){switch(o.label){case 0:return t=r[0],e&&e.length?[3,2]:[4,Promise.resolve(null)];case 1:return[2,o.sent()];case 2:for(n=null,i=e.length,a=0;a<i;a++)(u=e[a])&&((s=u.extent)||"point"!==u.type||(c=u).x&&c.y&&(s=new t({xmax:c.x,xmin:c.x,ymax:c.y,ymin:c.y,zmax:c.z,zmin:c.z,spatialReference:c.spatialReference})),s&&(n=n?n.union(s):s));return n.width<0&&n.height<0?[4,Promise.resolve(null)]:[3,4];case 3:return[2,o.sent()];case 4:return[4,Promise.resolve(n)];case 5:return[2,o.sent()]}}))}))}))];case 1:return[2,r.sent()]}}))}))}function d(e,t,r){if(t)for(var n=e.jimuLayerViews,i=Object.keys(n),o=0;o<i.length;o++){var u=n[i[o]];u&&u.layer&&u.layerDataSourceId===t&&u.type===a.LayerTypes.FeatureLayer&&u.setLocalDefinitionExpression(r)}}function h(e,t,r){if(t)for(var i=e.jimuLayerViews,o=Object.keys(i),u=function(u){var s=i[o[u]];if(s&&s.layer&&s.layerDataSourceId===t&&s.type===a.LayerTypes.FeatureLayer)if(s.view){var c=s.view;if(!c)return{value:null};Object(a.loadArcGISJSAPIModules)(["esri/tasks/support/Query","esri/Graphic"]).then((function(t){var n,a;n=t[0],a=t[1];var i=new n;i.where=r,i.outFields=["*"],i.returnGeometry=!0,c.layer.queryFeatures(i).then((function(t){if(t&&t.features&&t.features.length>0){var r=g(c.layer.geometryType);y(e.view,t.features,r,a)}}))}))}else Object(a.loadArcGISJSAPIModules)(["esri/tasks/support/Query","esri/layers/FeatureLayer","esri/Graphic"]).then((function(t){var a,i,o;a=t[0],i=t[1],o=t[2];var u=new a;u.where=r,u.outFields=["*"],u.returnGeometry=!0;var c=new i({url:n.dataSourceUtils.getUrlByLayer(s.layer)});c.load().then((function(){c.queryFeatures(u).then((function(t){if(t&&t.features&&t.features.length>0){var r=g(t.features[0].geometry.type);y(e.view,t.features,r,o)}}))}))}))},s=0;s<o.length;s++){var c=u(s);if("object"==typeof c)return c.value}}function y(e,t,r,n){!function(t,a){for(var i=[],o=0,u=0;u<t.length;u++){var s=new n({geometry:t[u].geometry,symbol:r,attributes:t[u].attributes});i.push(s)}var c=function(){e.graphics.addMany(i),setTimeout((function(){e.graphics.removeMany(i),(o+=1)<a&&setTimeout((function(){c()}),500)}),500)};c()}(t,3)}function g(e){return["point","multipoint"].includes(e)?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].includes(e)?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].includes(e)?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].includes(e)?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}function v(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}function m(e,t){var r=null;return e.clone?r=e.clone():(r=t.fromJSON(Object.assign({},e))).attributes=Object.assign({},e.attributes),r}function b(e,t){return i(this,void 0,Promise,(function(){return o(this,(function(r){switch(r.label){case 0:return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?[3,2]:[4,Promise.resolve(e)];case 1:return[2,r.sent()];case 2:return t.isWebMercator&&e[0].spatialReference.isWGS84?[4,Promise.resolve(e)]:[3,4];case 3:return[2,r.sent()];case 4:return t.isWGS84&&e[0].spatialReference.isWebMercator?[4,Promise.resolve(e)]:[3,6];case 5:return[2,r.sent()];case 6:return[4,a.geometryUtils.projectToSpatialReference(e,t)];case 7:return[2,r.sent()]}}))}))}function w(e,t,r){return i(this,void 0,Promise,(function(){var n=this;return o(this,(function(u){switch(u.label){case 0:return e&&"3d"===e.type&&t&&t.queryFeatures&&r?[4,Object(a.loadArcGISJSAPIModules)(["esri/tasks/support/Query"]).then((function(e){var a=new(0,e[0]);return a.returnGeometry=!0,a.outFields=["*"],a.objectIds=r.map((function(e){return e.attributes[t.objectIdField]})),t.queryFeatures(a).then((function(e){return i(n,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return e&&e.features&&e.features.length===r.length?[4,Promise.resolve(e.features)]:[3,2];case 1:return[2,t.sent()];case 2:return[4,Promise.resolve(r)];case 3:return[2,t.sent()]}}))}))}),(function(){return i(n,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve(r)];case 1:return[2,e.sent()]}}))}))}))}))]:[3,2];case 1:return[2,u.sent()];case 2:return[4,Promise.resolve(r)];case 3:return[2,u.sent()]}}))}))}function S(e){return!window.jimuConfig.isInBuilder||e!==n.AppMode.Design}function M(e){return{mapContainer:e.mapContainer,state:e.state,MapView:e.MapView,SceneView:e.SceneView,Extent:e.Extent,Viewpoint:e.Viewpoint,mapView:e.mapView,sceneView:e.sceneView,extentWatch:e.extentWatch,fatalErrorWatch:e.fatalErrorWatch,dsManager:e.dsManager,highLightHandles:e.highLightHandles,mapBaseViewEventHandles:e.mapBaseViewEventHandles,Color:e.Color,isRequestingMap:e.isRequestingMap}}function x(e,t){e.mapContainer=t.mapContainer,e.state=t.state,e.MapView=t.MapView,e.SceneView=t.SceneView,e.Extent=t.Extent,e.Viewpoint=t.Viewpoint,e.mapView=t.mapView,e.sceneView=t.sceneView,e.extentWatch=t.extentWatch,e.fatalErrorWatch=t.fatalErrorWatch,e.dsManager=t.dsManager,e.highLightHandles=t.highLightHandles,e.mapBaseViewEventHandles=t.mapBaseViewEventHandles,e.Color=t.Color,e.isRequestingMap=t.isRequestingMap}}}))}}}));