System.register(["jimu-core"],(function(e){var t;return{setters:[function(e){t=e}],execute:function(){e(function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,r){e.exports=t},function(e,t,r){"use strict";var n,i;r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return n})),function(e){e.Map="MAP",e.WebMap="WEB_MAP",e.WebScene="WEB_SCENE"}(n||(n={})),function(e){e.BaseDynamicLayer="base-dynamic",e.BaseElevationLayer="base-elevation",e.BaseTileLayer="base-tile",e.BuildingSceneLayer="building-scene",e.CSVLayer="csv",e.ElevationLayer="elevation",e.FeatureLayer="feature",e.GeoJSONLayer="geojson",e.GeoRSSLayer="geo-rss",e.GraphicsLayer="graphics",e.GroupLayer="group",e.ImageryLayer="imagery",e.IntegratedMeshLayer="integrated-mesh",e.KMLLayer="kml",e.MapImageLayer="map-image",e.MapNotesLayer="map-notes",e.PointCloudLayer="point-cloud",e.SceneLayer="scene",e.TileLayer="tile",e.UnknownLayer="unknown",e.UnsupportedLayer="unsupported",e.VectorTileLayer="vector-tile",e.WMSLayer="wms",e.WMTSLayer="wmts",e.WebTileLayer="web-tile"}(i||(i={}))},,function(e,t,r){"use strict";r.r(t),r.d(t,"JimuLayerView",(function(){return N})),r.d(t,"JimuFeatureLayerView",(function(){return Ie})),r.d(t,"JimuSceneLayerView",(function(){return $})),r.d(t,"ShowOnMapDataType",(function(){return U})),r.d(t,"SHOW_ON_MAP_DATA_ID_PREFIX",(function(){return ue})),r.d(t,"JimuMapView",(function(){return ce})),r.d(t,"JimuMapViewGroup",(function(){return pe})),r.d(t,"MapViewManager",(function(){return ye})),r.d(t,"DataSourceTypes",(function(){return Z.b})),r.d(t,"LayerTypes",(function(){return Z.c})),r.d(t,"ArcGISDataSourceTypes",(function(){return Z.a})),r.d(t,"ArcGISDependencyDefineExtension",(function(){return be})),r.d(t,"ArcGISDataSourceFactoryUriExtension",(function(){return Le})),r.d(t,"loadArcGISJSAPIModules",(function(){return c})),r.d(t,"JimuMapViewComponent",(function(){return Ve})),r.d(t,"JimuLayerViewComponent",(function(){return Pe})),r.d(t,"init",(function(){return Oe})),r.d(t,"geometryUtils",(function(){return n})),r.d(t,"zoomToUtils",(function(){return i})),r.d(t,"portalUtils",(function(){return a})),r.d(t,"defaultMessages",(function(){return Q}));var n={};r.r(n),r.d(n,"projectToSpatialReference",(function(){return p}));var i={};r.r(i),r.d(i,"zoomTo",(function(){return w}));var a={};r.r(a),r.d(a,"checkDefaultBaseMapIsExist",(function(){return _})),r.d(a,"getDefaultWebMap",(function(){return G}));var o=r(0),s=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},u=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function c(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,Object(o.loadArcGISJSAPIModules)(e)];case 1:return[2,t.sent()]}}))}))}var l=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},d=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function p(e,t){return l(this,void 0,void 0,(function(){var r=this;return d(this,(function(n){switch(n.label){case 0:return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?[3,2]:[4,Promise.resolve(e)];case 1:return[2,n.sent()];case 2:return[4,c(["esri/tasks/GeometryService","esri/tasks/support/ProjectParameters","esri/geometry/projection"]).then((function(n){return l(r,void 0,void 0,(function(){var r,i,a,o,s=this;return d(this,(function(u){switch(u.label){case 0:return r=n[0],i=n[1],(a=n[2]).isSupported()?a.isLoaded()?(o=function(e,t,r){return r.project(e,t)}(e,t,a),[4,Promise.resolve(o)]):[3,2]:[3,5];case 1:return[2,u.sent()];case 2:return a.load(),[4,h(e,t,r,i).then((function(e){return l(s,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve(e)];case 1:return[2,t.sent()]}}))}))}),(function(e){return l(s,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return console.error(e),[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))];case 3:return[2,u.sent()];case 4:return[3,7];case 5:return[4,h(e,t,r,i).then((function(e){return l(s,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve(e)];case 1:return[2,t.sent()]}}))}))}),(function(e){return l(s,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return console.error(e),[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))];case 6:return[2,u.sent()];case 7:return[2]}}))}))}))];case 3:return[2,n.sent()]}}))}))}function h(e,t,r,n){return l(this,void 0,void 0,(function(){var i,a,s;return d(this,(function(u){switch(u.label){case 0:return i=Object(o.getAppStore)().getState().portalSelf.helperServices.geometry.url,a=new r({url:i}),s=new n({geometries:e,outSpatialReference:t}),[4,a.project(s)];case 1:return[2,u.sent()]}}))}))}var f,y=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},g=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},v=null;function w(e,t,r){return y(this,void 0,void 0,(function(){var n=this;return g(this,(function(i){switch(i.label){case 0:return e?[3,2]:[4,Promise.reject(new Error("Invalid target."))];case 1:return[2,i.sent()];case 2:return t?[3,4]:[4,Promise.reject(new Error("Invalid target."))];case 3:return[2,i.sent()];case 4:return r||(r={}),[4,c(["esri/Graphic","esri/geometry/Extent","esri/layers/Layer","esri/layers/support/TileInfo"]).then((function(i){return y(n,void 0,void 0,(function(){var n,a,o;return g(this,(function(s){switch(s.label){case 0:return n=i[0],a=i[1],o=i[2],v=i[3],t instanceof a?[4,b(e,t,r.scale)]:[3,2];case 1:return[2,s.sent()];case 2:return Array.isArray(t)&&t.length&&t[0]instanceof n?[4,m(e,t,r.scale)]:[3,4];case 3:return[2,s.sent()];case 4:return t instanceof o?[4,I(e,t,null,null,r.scale)]:[3,6];case 5:return[2,s.sent()];case 6:return t.layer&&t.layer instanceof o&&t.extent&&t.extent instanceof a?[4,I(e,t.layer,null,t.extent,r.scale)]:[3,8];case 7:return[2,s.sent()];case 8:return t.layer&&t.layer instanceof o&&Array.isArray(t.graphics)&&t.graphics.length&&t.graphics[0]instanceof n?[4,I(e,t.layer,t.graphics,null,r.scale)]:[3,10];case 9:return[2,s.sent()];case 10:return[4,Promise.reject(new Error("Invalid target."))];case 11:return[2,s.sent()]}}))}))}))];case 5:return[2,i.sent()]}}))}))}function m(e,t,r){return y(this,void 0,void 0,(function(){var n=this;return g(this,(function(i){switch(i.label){case 0:return"3d"!==e.type||r?[4,j(e,t).then((function(t){return y(n,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return[4,b(e,t,r)];case 1:return[2,n.sent()]}}))}))})).catch((function(e){return y(n,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))]:[2,e.goTo(t)];case 1:return[2,i.sent()]}}))}))}function I(e,t,r,n,i){return y(this,void 0,void 0,(function(){var a,o=this;return g(this,(function(s){switch(s.label){case 0:return n&&S(n)?"3d"!==e.type||i?[3,2]:[4,p([n],e.spatialReference).then((function(t){return e.goTo(t)}))]:[3,3];case 1:return[2,s.sent()];case 2:return a=Promise.resolve(n),[3,4];case 3:if(r){if("3d"===e.type&&!i)return[2,e.goTo(r)];a=j(e,r)}else a=function(e,t){return y(this,void 0,void 0,(function(){return g(this,(function(r){switch(r.label){case 0:return"feature"!==t.type?[3,2]:[4,k(e,t)];case 1:return[2,r.sent()];case 2:return[4,Promise.resolve(t.fullExtent.clone())];case 3:return[2,r.sent()]}}))}))}(e,t);s.label=4;case 4:return[2,a.then((function(t){return y(o,void 0,void 0,(function(){return g(this,(function(r){switch(r.label){case 0:return[4,p([t],e.spatialReference).then((function(e){return e&&e[0]}))];case 1:return[2,r.sent()]}}))}))})).then((function(r){return y(o,void 0,void 0,(function(){var n,a,o;return g(this,(function(s){switch(s.label){case 0:return S(r)?[3,2]:[4,Promise.reject(new Error("Invalid extent."))];case 1:return[2,s.sent()];case 2:return i?(r=J(e,r),[4,A(e,r,i).then((function(t){return L(e,t)}))]):[3,4];case 3:return[2,s.sent()];case 4:return 4513.9887,n=t.minScale||0,a=t.maxScale||0,V(r)?(o=F(e,n,a,3))?("3d"===e.type&&4513.9887>o&&(o=0===n||4513.9887<n?4513.9887:n),r=J(e,r),[2,A(e,r,o).then((function(t){return L(e,t)}))]):[2]:(r=function(e,t){var r=e.size[0]/e.size[1],n=t.width/t.height;if(n>r){var i=t.width/r/2;t.ymin=t.center.y-i,t.ymax=t.center.y+i}else if(n<r){var a=t.height*r/2;t.xmin=t.center.x-a,t.xmax=t.center.x+a}return t}(e,r),[2,C(e,r).then((function(t){return n>0&&t>n?(n=O(e,n,!0),r=J(e,r),A(e,r,n).then((function(t){return L(e,t)}))):t<a?(a=O(e,a,!1),r=J(e,r),A(e,r,a).then((function(t){return L(e,t)}))):L(e,r)}))])}}))}))})).catch((function(e){return y(o,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))]}}))}))}function b(e,t,r){return y(this,void 0,void 0,(function(){var n=this;return g(this,(function(i){switch(i.label){case 0:return S(t=t.clone())?[3,2]:[4,Promise.reject(new Error("Invalid extent."))];case 1:return[2,i.sent()];case 2:return[4,p([t],e.spatialReference).then((function(r){var n=r&&r[0];return n||(n=t),V(n)?function(e,t){return y(this,void 0,void 0,(function(){var r;return g(this,(function(n){switch(n.label){case 0:return(r=F(e,0,0,3))?(t=J(e,t),[4,A(e,t,r)]):[3,2];case 1:return[2,n.sent()];case 2:return[4,Promise.reject()];case 3:return[2,n.sent()]}}))}))}(e,n):n})).then((function(t){return r?A(e,t,r):t})).then((function(t){return L(e,t)})).catch((function(e){return y(n,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))];case 3:return[2,i.sent()]}}))}))}function L(e,t){return e.goTo(t)}function S(e){return e&&M(e.xmin)&&M(e.ymin)&&M(e.xmax)&&M(e.ymax)}function M(e){return 0===e||!!e}function V(e){return e.xmin+f.X===e.xmax-f.X&&e.ymin+f.Y===e.ymax-f.Y}function j(e,t,r){return void 0===r&&(r={}),y(this,void 0,void 0,(function(){var n;return g(this,(function(i){switch(i.label){case 0:return(n=t&&t[0]&&t[0].layer)&&"scene"===n.type?[4,x(t,n,r.factor)]:[3,2];case 1:return[2,i.sent()];case 2:return"3d"!==e.type?[3,4]:[4,P(t,3)];case 3:return[2,i.sent()];case 4:return[4,P(t)];case 5:return[2,i.sent()]}}))}))}function x(e,t,r){return y(this,void 0,void 0,(function(){var r=this;return g(this,(function(n){switch(n.label){case 0:return[4,c(["esri/tasks/support/Query"]).then((function(n){return y(r,void 0,void 0,(function(){var r,i;return g(this,(function(a){return r=n[0],t?((i=new r).objectIds=e.map((function(e){return e.attributes[t.objectIdField]})),i.returnGeometry=!0,[2,t.queryExtent(i).then((function(e){return 1===e.count?e.extent.expand(3.5):e.extent.expand(2)}))]):[2,Promise.reject()]}))}))})).catch((function(e){return y(r,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))];case 1:return[2,n.sent()]}}))}))}function P(e,t){return y(this,void 0,void 0,(function(){var r=this;return g(this,(function(n){switch(n.label){case 0:return[4,c(["esri/Graphic","esri/geometry/Extent","esri/geometry/Point"]).then((function(r){var n,i,a,o=null,s=e;n=r[0],i=r[1],a=r[2];try{if(s&&1===s.length&&s[0].geometry&&"esri.geometry.Multipoint"===s[0].geometry.declaredClass&&1===s[0].geometry.points.length){var u=s[0].geometry.points[0];s=[new n({geometry:new a({x:u[0],y:u[1],spatialReference:s[0].geometry.spatialReference})})]}if(s&&1===s.length&&s[0].geometry&&"esri.geometry.Point"===s[0].geometry.declaredClass){var c=s[0].geometry;o=new i({xmin:c.x-f.X,ymin:c.y-f.Y,xmax:c.x+f.X,ymax:c.y+f.Y,spatialReference:c.spatialReference})}else s&&s.length>0&&(o=function(e,t){if(!e||!e.length)return null;var r,n=null,i=e.length;for(r=0;r<i;r++){var a=e[r].geometry;if(a){var o=a.extent;o||"point"!==a.type||null==a.x||null==a.y||(o=new t({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference})),o&&(n=n?n.union(o):o)}}if(!n||n.width<0||n.height<0)return null;return n}(s,i))&&t&&t>0&&(o=o.expand(t));return o}catch(e){return console.error(e),Promise.reject()}})).catch((function(e){return y(r,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.reject()];case 1:return[2,e.sent()]}}))}))}))];case 1:return[2,n.sent()]}}))}))}function D(e){var t=[];return e.map.basemap.baseLayers.forEach((function(e){e&&e.tileInfo&&e.tileInfo.lods&&t.length<e.tileInfo.lods.length&&(t=e.tileInfo.lods)})),0===t.length?v.create().lods:t}function F(e,t,r,n){var i,a=D(e),o=1;if(a){var s=[],u=[];a.forEach((function(e){t>0&&e.scale>t||(e.scale<r?u.push(e.scale):s.push(e.scale))})),s.reverse();var c=void 0;s.length>=1?(o=u.length?u.length/a.length:1,c=Math.floor((s.length-1)/(n/o)),i=s[c]):i=null}else i=0===t?null:(t-r)/n;return i}function O(e,t,r){var n,i=D(e);if(i){if(r){for(n=0;n<i.length;n++)if(i[n].scale<t)return i[n].scale-1;return i[i.length-1].scale-1}for(n=i.length-1;n>=0;n--)if(i[n].scale>t)return i[n].scale+1;return i[0].scale+1}return r?t-1:t+1}function J(e,t){var r=t.width*(e.size[1]/e.size[0])/5;return t.ymin=t.center.y-r,t.ymax=t.center.y+r,t}function A(e,t,r){return y(this,void 0,void 0,(function(){var n=this;return g(this,(function(i){switch(i.label){case 0:return[4,c(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(n){var i,a;i=n[0],a=n[1];var o,s,u=e.size[0],c=a,l=t.spatialReference;l&&(o=l.wkid,s=l.wkt);var d=null;if(o)d=c.values[c[o]];else if(s&&-1!==s.search(/^PROJCS/i)){var p=/UNIT\[([^\]]+)\]\]$/i.exec(s);p&&p[1]&&(d=parseFloat(p[1].split(",")[1]))}return t.expand(r*u/(39.37*(d||20015077/180)*(i.screenDPI||96))/t.width)})).catch((function(e){return y(n,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.reject()];case 1:return[2,e.sent()]}}))}))}))];case 1:return[2,i.sent()]}}))}))}function C(e,t){return y(this,void 0,void 0,(function(){var r=this;return g(this,(function(n){switch(n.label){case 0:return[4,c(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(r){var n,i;n=r[0],i=r[1];var a,o,s=e.size[0],u=i,c=t.spatialReference;c&&(a=c.wkid,o=c.wkt);var l=null;if(a)l=u.values[u[a]];else if(o&&-1!==o.search(/^PROJCS/i)){var d=/UNIT\[([^\]]+)\]\]$/i.exec(o);d&&d[1]&&(l=parseFloat(d[1].split(",")[1]))}return t.width/s*(l||20015077/180)*39.37*(n.screenDPI||96)})).catch((function(e){return y(r,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.reject()];case 1:return[2,e.sent()]}}))}))}))];case 1:return[2,n.sent()]}}))}))}function k(e,t){return y(this,void 0,void 0,(function(){var r,n,i=this;return g(this,(function(a){switch(a.label){case 0:return r=t.fullExtent.clone(),t.url?[3,2]:[4,Promise.resolve(r)];case 1:return[2,a.sent()];case 2:return(n=t.capabilities.query)?[4,c(["esri/tasks/support/Query"]).then((function(a){var o=new(0,a[0]);return o.where=t.definitionExpression?t.definitionExpression:"1=1",o.outSpatialReference=e.spatialReference,o.returnGeometry=!0,n.supportsExtent?t.queryExtent(o).then((function(e){return e.extent})).catch((function(e){return y(i,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve(r)];case 1:return[2,e.sent()]}}))}))})):t.queryFeatures(o).then((function(t){return y(i,void 0,void 0,(function(){return g(this,(function(r){switch(r.label){case 0:return[4,j(e,t.features)];case 1:return[2,r.sent()]}}))}))})).catch((function(e){return y(i,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve(r)];case 1:return[2,e.sent()]}}))}))}))})).catch((function(e){return y(i,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve(r)];case 1:return[2,e.sent()]}}))}))}))]:[3,4];case 3:return[2,a.sent()];case 4:return[4,Promise.resolve(r)];case 5:return[2,a.sent()]}}))}))}!function(e){e[e.X=1e-4]="X",e[e.Y=1e-4]="Y"}(f||(f={}));var R=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},E=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},W=" "+function(e){var t="",r=function(){var e=[];return e=(e=e.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat(["Feature Service","Map Service","Image Service","KML","WMS","Feature Collection","Feature Collection Template","Geodata Service","Globe Service"]).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat(["Symbol Set","Color Set","Shapefile","CSV","Service Definition","Document Link","Microsoft Word","Microsoft PowerPoint","Microsoft Excel","PDF","Image","Visio Document"])).concat(["Map Document","Map Package","Tile Package","ArcPad Package","Explorer Map","Globe Document","Scene Document","Published Map","Map Template","Windows Mobile Package"]).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat(["Workflow Manager Package","Desktop Application","Desktop Application Template","Code Sample","Desktop Add In","Explorer Add In"])}();if(e&&e.length>0&&e.length>0){for(var n="",i=0;i<e.length;i++){var a=' type:"'+e[i]+'" ';n+=a,i!==e.length-1&&(n+=" OR ")}t=" ( "+n+" ) ";var o=e.concat(r).filter((function(t){return e.every((function(e){return!e.toLowerCase().includes(t.toLowerCase())}))}));for(i=0;i<o.length;i++){a=' -type:"'+o[i]+'" ';t+=a}}return t}(["Web Map"])+" ",B=null;function _(){var e=Object(o.getAppStore)().getState().portalSelf;return!!(e&&e.defaultBasemap&&e.defaultBasemap.baseMapLayers&&e.defaultBasemap.baseMapLayers[0]&&e.defaultBasemap.baseMapLayers[0].url)}function G(e){return R(this,void 0,void 0,(function(){var t=this;return E(this,(function(r){return B?[2,B]:[2,B=c(["esri/portal/Portal"]).then((function(r){return R(t,void 0,void 0,(function(){var t,n,i=this;return E(this,(function(a){switch(a.label){case 0:return t=null,t=r[0],[4,(n=new t({url:e})).load().then((function(){return R(i,void 0,void 0,(function(){var t,r,i,a=this;return E(this,(function(o){switch(o.label){case 0:return t=n.sourceJSON,r=t.defaultBasemap&&t.defaultBasemap.id,i=t.defaultExtent,r?[4,Promise.resolve({defaultMapId:r,defaultExtent:i})]:[3,2];case 1:return[2,o.sent()];case 2:return[4,H(e,t,n).then((function(e){return R(a,void 0,void 0,(function(){var t=this;return E(this,(function(r){switch(r.label){case 0:return e?[4,Promise.resolve({defaultMapId:e,defaultExtent:i})]:[3,2];case 1:return[2,r.sent()];case 2:return[4,T(n).then((function(e){return R(t,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve({defaultMapId:e,defaultExtent:i})];case 1:return[2,t.sent()]}}))}))}))];case 3:return[2,r.sent()]}}))}))}))];case 3:return[2,o.sent()]}}))}))}))];case 1:return[2,a.sent()]}}))}))}))]}))}))}function T(e){return R(this,void 0,void 0,(function(){var t,r=this;return E(this,(function(n){switch(n.label){case 0:return t={start:1,num:1,f:"json",query:W+" AND access:public AND owner:esri_en",sortField:"num-views",sortOrder:"desc"},[4,e.queryItems(t).then((function(e){return R(r,void 0,void 0,(function(){var t,r;return E(this,(function(n){return(t=(t=e.results).filter((function(e){return e.type&&"web map"===e.type.toLowerCase()}))).length>0?(r=t[0],[2,Promise.resolve(r.id)]):[2,Promise.resolve(null)]}))}))}))];case 1:return[2,n.sent()]}}))}))}function H(e,t,r){return R(this,void 0,void 0,(function(){var e,n=this;return E(this,(function(i){switch(i.label){case 0:return e=t.defaultBasemap&&t.defaultBasemap.title,[4,r.queryGroups({f:"json",query:t.basemapGalleryGroupQuery}).then((function(t){return R(n,void 0,void 0,(function(){var n,i,a,o=this;return E(this,(function(s){switch(s.label){case 0:return(n=t.results).length>0?(i=n[0],a=W+" AND group:"+i.id+" AND title:"+e,[4,r.queryItems({start:1,num:1,f:"json",query:a}).then((function(t){return R(o,void 0,void 0,(function(){var n,i,a,o=this;return E(this,(function(s){return(n=(n=t.results).filter((function(e){return e.type&&"web map"===e.type.toLowerCase()}))).length>0?(i=n[0],[2,Promise.resolve(i.id)]):(a=W+" AND title:"+e,[2,r.queryItems({start:1,num:1,f:"json",query:a}).then((function(e){return R(o,void 0,void 0,(function(){var t,r;return E(this,(function(n){return(t=(t=e.results).filter((function(e){return e.type&&"web map"===e.type.toLowerCase()}))).length>0?(r=t[0],[2,Promise.resolve(r.id)]):[2,Promise.resolve(null)]}))}))}))])}))}))}))]):[3,2];case 1:return[2,s.sent()];case 2:return[2]}}))}))}))];case 1:return[2,i.sent()]}}))}))}var q,U,Q={layerIsNotSupported:"This layer type is not supported."},N=function(){function e(e){var t;if(this.runTimeIsHidden=!1,e.parentJimuLayerViewId?this.id=e.parentJimuLayerViewId+"-"+e.jimuLayerId:this.id=e.jimuMapViewId+"-"+e.jimuLayerId,this.view=e.view,this.type=e.type,this.layerDataSourceId=e.layerDataSourceId,this.jimuMapViewId=e.jimuMapViewId,this.jimuLayerId=e.jimuLayerId,this.layer=e.layer,this.layerIndex=e.layerIndex,this.parentJimuLayerViewId=e.parentJimuLayerViewId,this.dataSourceInfoObserver=Object(o.observeStore)(this.onLayerDataSourceInfoChange.bind(this),["dataSourcesInfo",this.layerDataSourceId]),this.getLayerDataSource()){var r=this.getLayerDataSource(),n=null===(t=r.getDataSourceJson())||void 0===t?void 0:t.isHidden;this.runTimeIsHidden=n,n&&(this.layer.visible=!n);var i=r.getRootDataSource();this.layerDataSourceJsonObserver=Object(o.observeStore)(this.onLayerDatasourceJsonChange.bind(this),["appConfig","dataSources",i.id])}}return e.prototype.onLayerDataSourceInfoChange=function(e,t){},e.prototype.onLayerDatasourceJsonChange=function(e,t){var r,n,i=null===(n=null===(r=this.getLayerDataSource())||void 0===r?void 0:r.getDataSourceJson())||void 0===n?void 0:n.isHidden;this.runTimeIsHidden!==i&&(this.runTimeIsHidden=i,this.layer.visible=!i)},e.prototype.getLayerDataSource=function(){return o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId)},e.prototype.selectFeaturesByIds=function(e){},e.prototype.selectFeatureById=function(e){},e.prototype.destroy=function(){this.dataSourceInfoObserver&&this.dataSourceInfoObserver()},e}(),z=(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),X=function(){return(X=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Y=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},K=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},$=function(e){function t(t){var r=e.call(this,t)||this;return r.features=[],r.isReservePopup=!1,r.selectedIds="",r.localDefinitionExpression="",r.getViewForMap().popup.watch("selectedFeature",(function(e){if(e){if(!e||!e.layer)return;if(e.layer===r.layer){var t=String(e.attributes[e.layer.objectIdField]);if(t===r.selectedIds)return;var n=r.getLayerDataSource(),i=ye.getInstance().getJimuMapViewById(r.jimuMapViewId);null==n||n.queryById(t).then((function(e){r.selectFeatureById(t,e),r.isReservePopup=!0,o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(i.mapWidgetId,[e]))}))}else r.isReservePopup=!1,r.selectFeatureById(null)}})),r.getViewForMap().popup.watch("visible",(function(e){var t=r.getViewForMap();if(!e&&t.popup.selectedFeature&&t.popup.selectedFeature.layer===r.layer){var n=ye.getInstance().getJimuMapViewById(r.jimuMapViewId);o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(n.mapWidgetId,[])),r.isReservePopup=!1,r.selectFeatureById(null)}})),r.getSelectedRecordIds().length>0?r.moveFeatureToCenter(r.getSelectedRecordIds()[0]).then((function(){r.highLightSelectedFeatures()})):r.getLayerDataSource()&&r.getLayerDataSource().getSelectedRecordIds().length>0&&r.moveFeatureToCenter(r.getLayerDataSource().getSelectedRecordIds()[0]).then((function(){r.highLightFeatures(r.getLayerDataSource().getSelectedRecordIds().map((function(e){return parseInt(e)})))}),(function(e){return console.error(e)})),r}return z(t,e),t.prototype.doQuery=function(e){return Y(this,void 0,void 0,(function(){var t=this;return K(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r){t.view.updating?(t.updateWatchHandle&&(t.updateWatchHandle.remove(),t.updateWatchHandle=null),t.updateWatchHandle=t.view.watch("updating",(function(n){n||t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}))}))):t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}),(function(e){console.error(e)}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.doQueryById=function(e){return Y(this,void 0,void 0,(function(){var t;return K(this,(function(r){switch(r.label){case 0:return t={objectIds:[parseInt(e)],returnGeometry:!0},[4,this.doQuery(t).then((function(e){return e[0]}))];case 1:return[2,r.sent()]}}))}))},t.prototype.mergeQuery=function(e,t){var r="("+e.where+") and ("+t.where+")";return X(X(X({},e),t),{where:r})},t.prototype.setRefreshIntervalForLayer=function(e){this.view&&null!=e&&(Object(o.getAppStore)().getState().appRuntimeInfo.appMode===o.AppMode.Design?this.layer.refreshInterval=0:this.layer.refreshInterval=e/60)},t.prototype.setDefinitionExpressionForLayer=function(e){var t,r,n=this;if(e){if(this.view&&this.view.layer){var i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};if((a=null===(t=this.getLayerDataSource())||void 0===t?void 0:t.getRealQueryParams(i,"query"))&&(this.view.layer.definitionExpression=a.where),e.geometry){if(this.view.filter&&this.view.filter.geometry===e.geometry)return;c(["esri/geometry/support/jsonUtils"]).then((function(t){var r=t[0];n.view.filter={geometry:r.fromJSON(e.geometry)}}))}else this.view.filter&&(this.view.filter=null);return}if(!this.view&&this.layer){var a;i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};(a=null===(r=this.getLayerDataSource())||void 0===r?void 0:r.getRealQueryParams(i,"query"))&&(this.layer.definitionExpression=a.where)}}},t.prototype.setLocalDefinitionExpression=function(e){var t;this.localDefinitionExpression=e,(null===(t=this.getLayerDataSource())||void 0===t?void 0:t.getCurrentQueryParams())&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams())},t.prototype.highLightSelectedFeatures=function(){this.highLightFeatures(this.getSelectedRecordIds().map((function(e){return parseInt(e)})))},t.prototype.highLightFeatures=function(e){var t=this;this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null),this.view&&this.view.when((function(){t.highLightHandle&&(t.highLightHandle.remove(),t.highLightHandle=null),t.highLightHandle=t.view.highlight(e)}))},t.prototype.clearHighLight=function(){this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null,this.isReservePopup&&(this.getViewForMap().popup.close(),this.isReservePopup=!1))},t.prototype.selectFeatureById=function(e,t){var r;null===(r=this.getLayerDataSource())||void 0===r||r.selectRecordById(e,t),null==e?this.clearHighLight():this.highLightSelectedFeatures()},t.prototype.selectFeaturesByIds=function(e,t){var r;null===(r=this.getLayerDataSource())||void 0===r||r.selectRecordsByIds(e,t),e&&e.length>0?this.highLightSelectedFeatures():this.clearHighLight()},t.prototype.onAppModeInfoChange=function(e,t){var r;this.setRefreshIntervalForLayer(null===(r=this.getLayerDataSource())||void 0===r?void 0:r.getAutoRefreshInterval())},t.prototype.onLayerDataSourceInfoChange=function(e,t){var r,n,i,a;(null===(r=null==t?void 0:t.selectedIds)||void 0===r?void 0:r.length)>0||(null===(n=null==t?void 0:t.selectedIndexes)||void 0===n?void 0:n.length)>0?this.selectedIds!==t.selectedIds.join(",")&&(this.selectedIds=t.selectedIds.join(","),this.highLightSelectedFeatures()):(this.selectedIds="",this.clearHighLight()),(null===(i=this.getLayerDataSource())||void 0===i?void 0:i.getCurrentQueryParams())&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams()),this.setRefreshIntervalForLayer(null===(a=this.getLayerDataSource())||void 0===a?void 0:a.getAutoRefreshInterval())},t.prototype.getViewForMap=function(){var e=ye.getInstance().getJimuMapViewById(this.jimuMapViewId);return e&&e.view},t.prototype.handleFeatureNavigationAtPopUp=function(e){var t=this.getLayerDataSource();this.isReservePopup=!0,null==t||t.selectRecordById(e)},t.prototype.moveFeatureToCenter=function(e){return Y(this,void 0,void 0,(function(){var t=this;return K(this,(function(r){switch(r.label){case 0:return[4,this.doQueryById(e).then((function(r){return r||(t.getLayerDataSource()?t.getLayerDataSource().queryById(e).then((function(e){return e&&e.feature})):null)})).then((function(r){return Y(t,void 0,void 0,(function(){var t;return K(this,(function(n){switch(n.label){case 0:return r?(t=this.getCenterPoint(r.geometry))?[4,this.getViewForMap().goTo(t)]:[3,2]:[3,5];case 1:return[2,n.sent()];case 2:return[4,Promise.reject("Does not find center point.")];case 3:return[2,n.sent()];case 4:return[3,7];case 5:return[4,Promise.reject("Dose not find feature."+e)];case 6:return[2,n.sent()];case 7:return[2]}}))}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.getCenterPoint=function(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}},t.prototype.getSelectedRecordIds=function(){var e=this;return Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId]?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds.asMutable():Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes.asMutable().map((function(t){return e.features[t].attributes[e.getIdField()]})):[]:[]},t.prototype.getIdField=function(){var e=this.view.layer.objectIdField;if(!e){var t=this.view.layer.fields.find((function(e){return"oid"===e.type}));t&&(e=t.name)}return e||(e="OBJECTID"),e},t.prototype.getLayerDataSource=function(){return o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId)},t.prototype.selectRecordsByQuery=function(e){return Y(this,void 0,void 0,(function(){var t=this;return K(this,(function(r){switch(r.label){case 0:return[4,c(["esri/layers/FeatureLayer"]).then((function(r){return Y(t,void 0,void 0,(function(){var t,r,n,i,a,s,u=this;return K(this,(function(c){switch(c.label){case 0:for(t=ye.getInstance().getJimuMapViewById(this.jimuMapViewId),r=t.getParentLayerViews(this.id),n=!0,i=0;i<r.length;i++)if(!r[i].layer.visible){n=!1;break}return n&&this.layer.visible?[3,2]:[4,Promise.resolve([])];case 1:return[2,c.sent()];case 2:return a=this.getLayerDataSource(),e.geometry=e.geometry.toJSON?e.geometry.toJSON():e.geometry,(s=null==a?void 0:a.dataSourceManager.createLocalDataSource(a,"view"))&&s.layer?[4,s.load(e,{widgetId:"view"}).then((function(e){return Y(u,void 0,void 0,(function(){var r,n,i,a;return K(this,(function(u){switch(u.label){case 0:if(!(e&&e.length>0))return[3,2];for(r=[],n=[],i=[],a=0;a<e.length;a++)r.push(e[a].getId()),n.push(e[a].feature),i.push(e[a]);return o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,i)),s.selectRecordsByIds(r),[4,Promise.resolve(n)];case 1:return[2,u.sent()];case 2:return[4,Promise.resolve([])];case 3:return[2,u.sent()]}}))}))}))]:[3,4];case 3:return[2,c.sent()];case 4:return[4,Promise.resolve([])];case 5:return[2,c.sent()]}}))}))}),(function(){return Y(t,void 0,void 0,(function(){return K(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve([])];case 1:return[2,e.sent()]}}))}))})).then((function(e){return Y(t,void 0,void 0,(function(){var t;return K(this,(function(r){switch(r.label){case 0:return(!e||e&&0===e.length)&&(null==(t=this.getLayerDataSource())||t.selectRecordsByIds([])),[4,Promise.resolve(e)];case 1:return[2,r.sent()]}}))}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.getObjectIdField=function(e,t){for(var r=null,n=0;n<e.length;n++)if(e[n].name===t)return r=e[n];return r},t}(N),Z=r(1),ee=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),te=function(e){function t(t){var r=e.call(this,t)||this;return r.url=null,r.url=t.url,r.layer&&r.layer.watch("visible",(function(e){var t=ye.getInstance().getJimuMapViewById(r.jimuMapViewId).getChildLayerViews(r.id);if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].virtualLayer&&(t[n].virtualLayer.visible=e&&t[n].layer.visible),t[n].view||t[n].type!==Z.c.FeatureLayer||t[n].highLightSelectedFeaturesWithVirtualLayer()})),r}return ee(t,e),t}(N),re=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ne=function(e){function t(t){var r=e.call(this,t)||this;return r.url=null,r.url=t.url,r.layer&&r.layer.watch("visible",(function(e){var t=ye.getInstance().getJimuMapViewById(r.jimuMapViewId).getChildLayerViews(r.id);if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].virtualLayer&&(t[n].virtualLayer.visible=e&&t[n].layer.visible),t[n].view||t[n].type!==Z.c.FeatureLayer||t[n].highLightSelectedFeaturesWithVirtualLayer()})),r}return re(t,e),t}(N),ie=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ae=function(e){function t(t){var r=e.call(this,t)||this;return r.url=null,r.url=t.url,r.layer&&r.layer.watch("visible",(function(e){var t=ye.getInstance().getJimuMapViewById(r.jimuMapViewId).getChildLayerViews(r.id);if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].virtualLayer&&(t[n].virtualLayer.visible=e&&t[n].layer.visible),t[n].view||t[n].type!==Z.c.FeatureLayer||t[n].highLightSelectedFeaturesWithVirtualLayer()})),r}return ie(t,e),t}(N),oe=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},se=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){e.DataAction="DATA_ACTION",e.MessageAction="MESSAGE_ACTION"}(U||(U={}));var ue="layer_of_showOnMap_action_",ce=function(){function e(e){var t=this;this.jimuLayerViewLoadPromises={},this.isEnableHighlight=!0,this.getJimuLayerViewId=function(e,r){var n=o.DataSourceManager.getInstance().getDataSource(e);if(!n)return null;var i=n.getJimuChildId(r)[0];return t.id+"-"+i},this.clearSelectedFeatures=function(){for(var e=t.jimuLayerViews,r=Object.keys(e),n=0;n<r.length;n++){var i=e[r[n]];i.type!==Z.c.FeatureLayer&&i.type!==Z.c.SceneLayer||i.selectFeaturesByIds([])}o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))},this.getSelectRecordsByQueryPromise=function(e,r){return oe(t,void 0,void 0,(function(){return se(this,(function(t){switch(t.label){case 0:return[4,e.selectRecordsByQuery(r)];case 1:return[2,t.sent()]}}))}))},this.id=e.mapWidgetId+"-"+e.datasourceId,this.mapWidgetId=e.mapWidgetId,this.isActive=e.isActive,this.datasourceId=e.datasourceId,this.view=e.view,this.jimuLayerViews={},this.status=o.JimuMapViewStatus.Loading,this.isEnablePopup=void 0===e.isEnablePopup||null===e.isEnablePopup||e.isEnablePopup,this.isEditing=!1,this.showOnMapDatas={},this.initView(this.view)}return e.prototype.startEdit=function(){this.isEditing=!0},e.prototype.exitEdit=function(){this.isEditing=!1},e.prototype.getIsEditing=function(){return this.isEditing},e.prototype.enablePopup=function(){this.isEditing&&!this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!0,this.isEnablePopup=!0)},e.prototype.disablePopup=function(){this.isEditing&&this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!1,this.isEnablePopup=!1)},e.prototype.getIsEnablePopup=function(){return this.isEnablePopup},e.prototype.enableHighlight=function(){this.isEditing&&!this.isEnableHighlight&&(this.isEnableHighlight=!0)},e.prototype.disableHighlight=function(){this.isEditing&&this.isEnableHighlight&&(this.isEnableHighlight=!1)},e.prototype.getIsEnableHighlight=function(){return this.isEnableHighlight},e.prototype.setIsActive=function(e){this.isActive=e,ye.getInstance().setJimuMapView(this)},e.prototype.initView=function(e){var t=this;e&&e.when((function(){e.on("click",t.onClick.bind(t))}))},e.prototype.onClick=function(e){var t=this,r={x:e.x,y:e.y};this.view.hitTest(r).then((function(e){if(t.isEnableHighlight&&(e&&e.results&&0!==e.results.length||(t.clearAllJimuLayerViewsSelectRecord(),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))),e.results.length)){var r=t.jimuLayerViews,n=Object.keys(r),i=Object.keys(r);if("2d"==t.view.type){var a=!1;t.isEnablePopup||t.isEditing||(a=!0),e.results.forEach((function(e,r){var i=e.graphic;if(i&&i.layer){var s=i.layer.id,u=t.getJimuLayerViewId(t.datasourceId,s),c=t.jimuLayerViews[u];if(c)switch(c.type){case Z.c.FeatureLayer:if(a&&i.layer.popupEnabled){n.splice(n.indexOf(u),1),c.clearHighLight();var l=String(i.attributes[i.layer.objectIdField]),d=c.getLayerDataSource();c.selectedIds=l,null==d||d.queryById(l).then((function(e){c.selectFeatureById(l,e),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))})),a=!1}}}}))}else e.results.forEach((function(e,r){var i=e.graphic;if(i&&i.layer){var a=i.layer.id,s=t.getJimuLayerViewId(t.datasourceId,a),u=t.jimuLayerViews[s];if(u)switch(u.type){case Z.c.FeatureLayer:if(0===r&&i.layer.popupEnabled){n.splice(n.indexOf(s),1),u.clearHighLight();var c=String(i.attributes[i.layer.objectIdField]),l=u.getLayerDataSource();u.selectedIds=c,l&&l.queryById(c).then((function(e){u.selectFeatureById(c,e),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))}))}break;case Z.c.SceneLayer:if(0===r&&i.layer.popupEnabled){n.splice(n.indexOf(s),1),u.clearHighLight();var d=String(i.attributes[i.layer.objectIdField]);l=u.getLayerDataSource();u.selectedIds=d,l&&l.queryById(d).then((function(e){u.selectFeatureById(d,e),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))}))}}}}));if(n)for(var s=0;s<n.length;s++){var u=t.jimuLayerViews[n[s]];if(u)switch(u.type){case Z.c.FeatureLayer:u.selectFeaturesByIds([])}}i&&n&&i.length===n.length&&i.length>0&&o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))}}),(function(){t.clearAllJimuLayerViewsSelectRecord()}))},e.prototype.clearAllJimuLayerViewsSelectRecord=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),r=0;r<t.length;r++){e[t[r]].selectFeaturesByIds([])}},e.prototype.createJimuLayerViews=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(e){switch(e.label){case 0:return[4,this.whenAllJimuLayerViewsLoaded(this.view)];case 1:return[2,e.sent()]}}))}))},e.prototype.addJimuLayerView=function(e){this.jimuLayerViews[e.id]=e},e.prototype.whenJimuMapViewLoaded=function(){return oe(this,void 0,void 0,(function(){var e=this;return se(this,(function(t){switch(t.label){case 0:return this.jimuMapViewLoadPromise?[4,this.jimuMapViewLoadPromise]:[3,2];case 1:return[2,t.sent()];case 2:return this.view?[3,4]:(this.status=o.JimuMapViewStatus.Failed,ye.getInstance().setJimuMapView(this),this.jimuMapViewLoadPromise=Promise.reject(this),[4,this.jimuMapViewLoadPromise]);case 3:return[2,t.sent()];case 4:return this.jimuMapViewLoadPromise=this.view.when().then((function(){return oe(e,void 0,void 0,(function(){var e=this;return se(this,(function(t){switch(t.label){case 0:return[4,this.createJimuLayerViews().then((function(){return oe(e,void 0,void 0,(function(){return se(this,(function(e){switch(e.label){case 0:return this.status=o.JimuMapViewStatus.Loaded,ye.getInstance().setJimuMapView(this),[4,Promise.resolve(this)];case 1:return[2,e.sent()]}}))}))}))];case 1:return[2,t.sent()]}}))}))}),(function(t){return oe(e,void 0,void 0,(function(){return se(this,(function(e){switch(e.label){case 0:return console.error(t),this.status=o.JimuMapViewStatus.Failed,ye.getInstance().setJimuMapView(this),[4,Promise.reject(this)];case 1:return[2,e.sent()]}}))}))})),[4,this.jimuMapViewLoadPromise];case 5:return[2,t.sent()]}}))}))},e.prototype.whenAllJimuLayerViewsLoaded=function(e){return oe(this,void 0,void 0,(function(){var t,r,n=this;return se(this,(function(i){switch(i.label){case 0:return t=[],r=this,e.map.layers.toArray().map((function(i,a){var s=o.DataSourceManager.getInstance().getDataSource(n.datasourceId);if(s){var u=s.getJimuChildId(o.dataSourceUtils.fixLayerId(i.id))[0];n.maxLayerIndex=e.map.layers.length-1;var c=e.whenLayerView(i).then((function(e){return oe(n,void 0,void 0,(function(){var t,r,n,c,l,d,p,h;return se(this,(function(f){switch(f.label){case 0:switch(t=null,r=null,n=s.getDataSourceByLayer(i.id,null===(h=o.dataSourceUtils.getJSAPILayerBySublayer(i))||void 0===h?void 0:h.id),i.type){case Z.c.SceneLayer:t={jimuLayerId:u,layerDataSourceId:n&&n.id,view:e,jimuMapViewId:this.id,type:i.type,layer:i,layerIndex:a,parentJimuLayerViewId:null},r=new $(t),this.addJimuLayerView(r);break;case Z.c.FeatureLayer:t={jimuLayerId:u,layerDataSourceId:n&&n.id,view:e,jimuMapViewId:this.id,type:i.type,layer:i,layerIndex:a,parentJimuLayerViewId:null},r=new Ie(t),this.addJimuLayerView(r);break;case Z.c.MapImageLayer:case Z.c.TileLayer:if(t={jimuLayerId:u,layerDataSourceId:n&&n.id,view:e,jimuMapViewId:this.id,type:i.type,layer:i,layerIndex:a,parentJimuLayerViewId:null},i.type===Z.c.MapImageLayer&&(r=new ae(t)),i.type===Z.c.TileLayer&&(r=new ne(t)),this.addJimuLayerView(r),(c=i.sublayers)&&c.length>0)for(d=0;d<c.length;d++)p=c.getItemAt(d),this.createJimuLayerViewInSublayersOfImageLayer(p,r.id);break;case Z.c.GroupLayer:if(t={jimuLayerId:u,layerDataSourceId:n&&n.id,view:null,jimuMapViewId:this.id,type:i.type,layer:i,layerIndex:a,parentJimuLayerViewId:null},r=new te(t),this.addJimuLayerView(r),(l=i.layers)&&l.length>0)for(d=0;d<l.length;d++)p=l.getItemAt(d),this.createJimuLayerViewInlayersOfGroupLayer(p,r.id);break;default:t={jimuLayerId:u,layerDataSourceId:n&&n.id,view:e,jimuMapViewId:this.id,type:i.type,layer:i,layerIndex:a,parentJimuLayerViewId:null},r=new N(t),this.addJimuLayerView(r)}return[4,Promise.resolve(r)];case 1:return[2,f.sent()]}}))}))}),(function(){return oe(n,void 0,void 0,(function(){return se(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve(null)];case 1:return[2,e.sent()]}}))}))}));t.push(c),r.jimuLayerViewLoadPromises[n.id+"-"+u]=c}})),[4,Promise.all(t)];case 1:return[2,i.sent()]}}))}))},e.prototype.getParentLayerViews=function(e){for(var t=[],r=this.jimuLayerViews[e];r.parentJimuLayerViewId;){var n=this.jimuLayerViews[r.parentJimuLayerViewId];t.push(n),r=n}return t},e.prototype.getChildLayerViews=function(e){var t=[];return this.findChildLayerView(e,t),t},e.prototype.findChildLayerView=function(e,t){for(var r=this.jimuLayerViews,n=Object.keys(r),i=0;i<n.length;i++){if(r[n[i]].parentJimuLayerViewId===e){var a=r[n[i]];t.push(a),this.findChildLayerView(a.id,t)}}},e.prototype.updateMaxLayerIndex=function(){return this.maxLayerIndex=this.maxLayerIndex+1,this.maxLayerIndex},e.prototype.createJimuLayerViewInlayersOfGroupLayer=function(e,t){var r,n,i,a=this,s=o.DataSourceManager.getInstance().getDataSource(this.datasourceId);if(e.type===Z.c.GroupLayer&&e.layers&&e.layers.length>0){if(!(d=s.getDataSourceByLayer(e.id,null===(r=o.dataSourceUtils.getJSAPILayerBySublayer(e))||void 0===r?void 0:r.id)))return;var u={jimuLayerId:e.id,layerDataSourceId:d&&d.id,view:null,url:e.url,jimuMapViewId:this.id,type:Z.c.GroupLayer,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},c=new te(u);this.addJimuLayerView(c);for(var l=0;l<e.layers.length;l++)this.createJimuLayerViewInlayersOfGroupLayer(e.layers.getItemAt(l),c.id)}else if((e.type===Z.c.TileLayer||e.type===Z.c.MapImageLayer)&&e.sublayers&&e.sublayers.length>0){var d;if(!(d=s.getDataSourceByLayer(e.id,null===(n=o.dataSourceUtils.getJSAPILayerBySublayer(e))||void 0===n?void 0:n.id)))return;u={jimuLayerId:e.id,layerDataSourceId:d&&d.id,view:null,url:e.url,jimuMapViewId:this.id,type:e.type,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},c=new te(u);this.addJimuLayerView(c);for(l=0;l<e.sublayers.length;l++)this.createJimuLayerViewInSublayersOfImageLayer(e.sublayers.getItemAt(l),c.id)}else{var p=s.getDataSourceByLayer(e.id,null===(i=o.dataSourceUtils.getJSAPILayerBySublayer(e))||void 0===i?void 0:i.id);if(!p)return;var h=this.updateMaxLayerIndex();this.view.whenLayerView(e).then((function(r){var n={jimuLayerId:e.id,layerDataSourceId:p&&p.id,view:r,url:e.url,jimuMapViewId:a.id,type:e.type,layer:e,parentJimuLayerViewId:t,layerIndex:h},i=new Ie(n);a.addJimuLayerView(i)}))}},e.prototype.createJimuLayerViewInSublayersOfImageLayer=function(e,t){var r,n,i=o.DataSourceManager.getInstance().getDataSource(this.datasourceId);if(e.sublayers&&e.sublayers.length>0){if(!(c=i.getDataSourceByLayer(e.id,null===(r=o.dataSourceUtils.getJSAPILayerBySublayer(e))||void 0===r?void 0:r.id)))return;var a={jimuLayerId:e.id,layerDataSourceId:c&&c.id,view:null,url:e.url,jimuMapViewId:this.id,type:Z.c.GroupLayer,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},s=new te(a);this.addJimuLayerView(s);for(var u=0;u<e.sublayers.length;u++)this.createJimuLayerViewInSublayersOfImageLayer(e.sublayers.getItemAt(u),s.id)}else{var c;if(!(c=i.getDataSourceByLayer(e.id,null===(n=o.dataSourceUtils.getJSAPILayerBySublayer(e))||void 0===n?void 0:n.id)))return;a={jimuLayerId:e.id,layerDataSourceId:c&&c.id,view:null,url:e.url,jimuMapViewId:this.id,type:Z.c.FeatureLayer,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},s=new Ie(a);this.addJimuLayerView(s)}},e.prototype.getJimuLayerViewLoadPromiseById=function(e){return oe(this,void 0,void 0,(function(){return se(this,(function(t){switch(t.label){case 0:return[4,this.jimuLayerViewLoadPromises[e]];case 1:return[2,t.sent()]}}))}))},e.prototype.selectFeaturesByGraphic=function(e,t){return oe(this,void 0,void 0,(function(){var r=this;return se(this,(function(n){switch(n.label){case 0:return[4,c(["esri/geometry/geometryEngine"]).then((function(n){return oe(r,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,d,p;return se(this,(function(h){switch(h.label){case 0:for(r=n[0],"point"!==(i=e.geometry).type&&"polyline"!==i.type||(a=2.54*this.view.scale/9600,i=r.buffer(i,10*a,"meters")),o={geometry:i,spatialRelationship:t,returnGeometry:!0,outFields:["*"]},s=this.jimuLayerViews,u=Object.keys(s),c=[],l=0;l<u.length;l++)(d=s[u[l]]).type!==Z.c.FeatureLayer&&d.type!==Z.c.SceneLayer||(p=this.getSelectRecordsByQueryPromise(d,o),c.push(p));return[4,Promise.all(c)];case 1:return[2,h.sent()]}}))}))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.destroy=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),r=0;r<t.length;r++){e[t[r]].destroy()}if(this.view&&!this.view.destroyed){this.view.graphics&&this.view.graphics.destroyed&&this.view.graphics.destroy(),this.view.container=null,this.view.allLayerViews&&this.view.allLayerViews.destroyed&&this.view.allLayerViews.destroy(),this.view.layerViews&&this.view.layerViews.destroyed&&this.view.layerViews.destroy();var n=this.view.ui;n.exbMapTools&&0!==Object.keys(n.exbMapTools).length&&Object.keys(n.exbMapTools).map((function(e,t){n.exbMapTools[e].destroy()})),n.exbMapTools={},this.view.destroy(),this.view=null}},e.prototype._getDefaultJimuMapViewId=function(){var e=this,t=Object(o.getAppStore)().getState().jimuMapViewsInfo;return Object.keys(t||{}).find((function(r){return t[r].mapWidgetId===e.mapWidgetId}))},e.prototype.drawDataOnMap=function(e){var t=this;Object.entries(e).forEach((function(e){var r=e[1].jimuMapViewId;r||e[1].mapWidgetId!==t.mapWidgetId||(r=t._getDefaultJimuMapViewId()),t.showOnMapDatas[e[0]]||r!==t.id?r===t.id&&t.updateDrewFeatureSet(e[1].dataSource,e[1].records,e[0],e[1].title):t.drawFeatureSet(e[1].dataSource,e[1].records,e[0],e[1].title),t.showOnMapDatas[e[0]]=e[1]})),Object.entries(this.showOnMapDatas).forEach((function(r){if(!e[r[0]]){var n=t.view.map.findLayerById(r[0]);delete t.showOnMapDatas[r[0]],n&&t.view.map.remove(n)}}))},e.prototype.drawFeatureSet=function(e,t,r,n){return oe(this,void 0,void 0,(function(){var i=this;return se(this,(function(a){return c(["esri/layers/GraphicsLayer"]).then((function(a){return oe(i,void 0,void 0,(function(){var i,o,s,u;return se(this,(function(c){switch(c.label){case 0:return i=a[0],s=i.bind,u={id:r,title:n,listMode:"hide"},[4,this.getGraphicsFromRecords(e,t)];case 1:return o=new(s.apply(i,[void 0,(u.graphics=c.sent(),u)])),this.view.map.add(o),[2]}}))}))})).catch((function(e){console.warn(e)})),[2]}))}))},e.prototype.updateDrewFeatureSet=function(e,t,r,n){return oe(this,void 0,void 0,(function(){var n,i,a,o=this;return se(this,(function(s){switch(s.label){case 0:return(n=this.view.map.findLayerById(r))&&t.some((function(e,t){var n,i;return e.getId()!==(null===(i=null===(n=o.showOnMapDatas[r])||void 0===n?void 0:n.records[t])||void 0===i?void 0:i.getId())}))?(n.removeAll(),a=(i=n).addMany,[4,this.getGraphicsFromRecords(e,t)]):[3,2];case 1:a.apply(i,[s.sent()]),s.label=2;case 2:return[2]}}))}))},e.prototype.getGraphicsFromRecords=function(e,t){return oe(this,void 0,void 0,(function(){var r=this;return se(this,(function(n){switch(n.label){case 0:return[4,c(["esri/Graphic","esri/symbols/support/symbolUtils"]).then((function(n){return oe(r,void 0,void 0,(function(){var r,i,a,o=this;return se(this,(function(s){switch(s.label){case 0:return r=n[0],i=n[1],a=t.map((function(t){return oe(o,void 0,void 0,(function(){var n,a,o,s,u,c;return se(this,(function(l){switch(l.label){case 0:switch(e.getGeometryType()){case"esriGeometryPoint":a="point";break;case"esriGeometryPolygon":a="polygon";break;case"esriGeometryPolyline":a="polyline"}return"esri.Graphic"!==(null==(o=t.feature)?void 0:o.declaredClass)?[3,3]:(n=o.clone()).symbol?[3,2]:(s=n,[4,this.getDefaultSymbol(i,n,a)]);case 1:s.symbol=l.sent(),l.label=2;case 2:return[3,5];case 3:return o.geometry.type=a,u=r.bind,c={geometry:o.geometry,attributes:o.attributes},[4,this.getDefaultSymbol(i,n,a)];case 4:n=new(u.apply(r,[void 0,(c.symbol=l.sent(),c)])),l.label=5;case 5:return[2,n]}}))}))})),[4,Promise.allSettled(a).then((function(e){return e.map((function(e){return e.value}))}))];case 1:return[2,s.sent()]}}))}))})).catch((function(e){return console.warn(e),null}))];case 1:return[2,n.sent()]}}))}))},e.prototype.getDefaultSymbol=function(e,t,r){return oe(this,void 0,void 0,(function(){var n,i;return se(this,(function(a){switch(a.label){case 0:switch(n=null,r){case"point":return[3,1];case"polyline":return[3,2];case"polygon":return[3,5]}return[3,6];case 1:return n={type:"simple-marker",color:[255,255,0,.6],outline:{color:[255,255,0,.6],width:1}},[3,6];case 2:return i=void 0,n={type:"simple-line",color:[255,255,0,.6]},(null==t?void 0:t.layer)?[4,this.getDefaultSymbolByRenderer(e,t,r)]:[3,4];case 3:i=a.sent(),a.label=4;case 4:return(null==i?void 0:i.color)?i.color=n.color:(null==i?void 0:i.material)&&(i.material.color=n.color),n=i||n,[3,6];case 5:return n={type:"simple-fill",color:[255,255,0,.6],outline:{color:[255,255,0,.6],width:1}},[3,6];case 6:return[2,Promise.resolve(n)]}}))}))},e.prototype.getDefaultSymbolByRenderer=function(e,t,r){return oe(this,void 0,void 0,(function(){return se(this,(function(r){return[2,e.getDisplayedSymbol(t).then((function(e){return e})).catch((function(){return null}))]}))}))},e}(),le=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},de=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},pe=function(){function e(e){var t=this;this.switchMap=function(){return le(t,void 0,void 0,(function(){return de(this,(function(e){switch(e.label){case 0:return this.mapWidgetInstance?[4,this.mapWidgetInstance.switchMap()]:[3,2];case 1:return[2,e.sent()];case 2:return[4,Promise.resolve()];case 3:return[2,e.sent()]}}))}))},this.fullScreenMap=function(){t.mapWidgetInstance&&t.mapWidgetInstance.fullScreenMap()},this.mapWidgetId=e,this.jimuMapViews={}}return e.prototype.setMapWidgetInstance=function(e){this.mapWidgetInstance=e},e.prototype.addJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.setJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.removeJimuMapView=function(e){delete this.jimuMapViews[e.id]},e.prototype.getActiveJimuMapView=function(){for(var e=Object.keys(this.jimuMapViews),t=0;t<e.length;t++)if(this.jimuMapViews[e[t]].isActive)return this.jimuMapViews[e[t]];return null},e}(),he=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},fe=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ye=function(){function e(){this.jimuMapViewGroups={}}return e.getInstance=function(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._mapViewManager:(e._instance||(e._instance=new e,window._mapViewManager=e._instance),e._instance)},e.prototype.getJimuMapViewById=function(e){var t=Object.keys(this.jimuMapViewGroups);if(0===t.length)return null;for(var r=0;r<t.length;r++){var n=t[r];if(Object.keys(this.jimuMapViewGroups[n].jimuMapViews).includes(e))return this.jimuMapViewGroups[n].jimuMapViews[e]}return null},e.prototype.getJimuMapViewGroup=function(e){return this.jimuMapViewGroups[e]?this.jimuMapViewGroups[e]:null},e.prototype.createJimuMapView=function(e){return he(this,void 0,void 0,(function(){var t,r;return fe(this,(function(n){switch(n.label){case 0:return t=e.mapWidgetId+"-"+e.datasourceId,this.getJimuMapViewById(t)?[4,Promise.resolve(this.getJimuMapViewById(t))]:[3,2];case 1:return[2,n.sent()];case 2:return r=new ce(e),this.addJimuMapView(r),[4,r.whenJimuMapViewLoaded()];case 3:return[2,n.sent()]}}))}))},e.prototype.addJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].addJimuMapView(e);else{var t=new pe(e.mapWidgetId);t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}Object(o.getAppStore)().dispatch(o.appActions.jimuMapViewAdded(e.id,Object(o.Immutable)({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,status:e.status})))},e.prototype.setJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].setJimuMapView(e);else{var t=new pe(e.mapWidgetId);t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}Object(o.getAppStore)().dispatch(o.appActions.jimuMapViewUpdated(e.id,Object(o.Immutable)({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,isActive:e.isActive,status:e.status})))},e.prototype.destroyJimuMapView=function(e){var t=this.getJimuMapViewById(e);t&&t.destroy();var r=Object.keys(this.jimuMapViewGroups);if(0===r.length);else for(var n=0;n<r.length;n++){var i=r[n];if(Object.keys(this.jimuMapViewGroups[i].jimuMapViews).includes(e)){delete this.jimuMapViewGroups[i].jimuMapViews[e],0===Object.keys(this.jimuMapViewGroups[i].jimuMapViews).length&&delete this.jimuMapViewGroups[i],Object(o.getAppStore)().dispatch(o.appActions.jimuMapViewRemoved(e));break}}},e.prototype.getAllJimuMapViewIds=function(){var e=this,t=[];return Object.keys(this.jimuMapViewGroups).forEach((function(r){Object.keys(e.jimuMapViewGroups[r].jimuMapViews).forEach((function(e){t.push(e)}))})),t},e.prototype.destroyAllJimuMapViews=function(){var e=this;this.getAllJimuMapViewIds().forEach((function(t){e.destroyJimuMapView(t)}))},e}(),ge=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ve=function(){return(ve=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},we=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},me=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Ie=function(e){function t(t){var r=e.call(this,t)||this;return r.features=[],r.isReservePopup=!1,r.virtualLayer=null,r.selectedIds="",r.localDefinitionExpression="",r.originalGdbVersion=null,r.view&&(r.originalGdbVersion=r.layer.gdbVersion),r.layer&&r.layer.watch("visible",(function(e,t){r.virtualLayer&&(r.virtualLayer.visible=e),r.view||r.highLightSelectedFeaturesWithVirtualLayer()})),r.getViewForMap().popup.watch("selectedFeature",(function(e){if(e){if(!e||!e.layer)return;if(e.layer===r.layer){var t=String(e.attributes[e.layer.objectIdField]);if(t===r.selectedIds)return;var n=r.getLayerDataSource(),i=ye.getInstance().getJimuMapViewById(r.jimuMapViewId);null==n||n.queryById(t).then((function(e){r.selectFeatureById(t,e),r.isReservePopup=!0,o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(i.mapWidgetId,[e]))}))}else r.isReservePopup=!1,r.selectFeatureById(null)}})),r.getViewForMap().popup.watch("visible",(function(e){var t=r.getViewForMap();if(!e&&t.popup.selectedFeature&&t.popup.selectedFeature.layer===r.layer){var n=ye.getInstance().getJimuMapViewById(r.jimuMapViewId);o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(n.mapWidgetId,[])),r.isReservePopup=!1,r.selectFeatureById(null)}})),r.getSelectedRecordIds().length>0?r.moveFeatureToCenter(r.getSelectedRecordIds()[0]).then((function(){r.highLightSelectedFeatures()})):r.getLayerDataSource()&&r.getLayerDataSource().getSelectedRecordIds().length>0&&r.moveFeatureToCenter(r.getLayerDataSource().getSelectedRecordIds()[0]).then((function(){r.highLightFeatures(r.getLayerDataSource().getSelectedRecordIds().map((function(e){return parseInt(e)})))}),(function(e){return console.error(e)})),window&&window.jimuConfig&&window.jimuConfig.isInBuilder&&(r.appModeObserver=Object(o.observeStore)(r.onAppModeInfoChange.bind(r),["appRuntimeInfo","appMode"])),r}return ge(t,e),t.prototype.doQuery=function(e){return we(this,void 0,void 0,(function(){var t=this;return me(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r){t.view.updating?(t.updateWatchHandle&&(t.updateWatchHandle.remove(),t.updateWatchHandle=null),t.updateWatchHandle=t.view.watch("updating",(function(n){n||t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}))}))):t.view.queryFeatures(e).then((function(e){t.features=e.features,r(t.features)}),(function(e){console.error(e)}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.doQueryById=function(e){return we(this,void 0,void 0,(function(){var t;return me(this,(function(r){switch(r.label){case 0:return t={objectIds:[parseInt(e)],returnGeometry:!0},[4,this.doQuery(t).then((function(e){return e[0]}))];case 1:return[2,r.sent()]}}))}))},t.prototype.mergeQuery=function(e,t){var r="("+e.where+") and ("+t.where+")";return ve(ve(ve({},e),t),{where:r})},t.prototype.setRefreshIntervalForLayer=function(e){this.view&&null!=e&&(Object(o.getAppStore)().getState().appRuntimeInfo.appMode===o.AppMode.Design?this.layer.refreshInterval=0:this.layer.refreshInterval=e/60)},t.prototype.setDefinitionExpressionForLayer=function(e){var t,r,n=this;if(e){if(this.view&&this.view.layer){var i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};if((a=null===(t=this.getLayerDataSource())||void 0===t?void 0:t.getRealQueryParams(i,"query"))&&(this.view.layer.definitionExpression=a.where),e.geometry){if(this.view.filter&&this.view.filter.geometry===e.geometry)return;c(["esri/geometry/support/jsonUtils"]).then((function(t){var r=t[0];n.view.filter={geometry:r.fromJSON(e.geometry)}}))}else this.view.filter&&(this.view.filter=null);return}if(!this.view&&this.layer){var a;i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};(a=null===(r=this.getLayerDataSource())||void 0===r?void 0:r.getRealQueryParams(i,"query"))&&(this.layer.definitionExpression=a.where)}}},t.prototype.setLocalDefinitionExpression=function(e){var t;this.localDefinitionExpression=e,(null===(t=this.getLayerDataSource())||void 0===t?void 0:t.getCurrentQueryParams())&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams())},t.prototype.highLightSelectedFeatures=function(){this.view?this.highLightFeatures(this.getSelectedRecordIds().map((function(e){return parseInt(e)}))):this.highLightSelectedFeaturesWithVirtualLayer()},t.prototype.highLightSelectedFeaturesWithVirtualLayer=function(){for(var e=this,t=ye.getInstance().getJimuMapViewById(this.jimuMapViewId),r=t.getParentLayerViews(this.id),n=!0,i=0;i<r.length;i++)if(!r[i].layer.visible){n=!1;break}if(n&&this.layer.visible){this.virtualLayer&&(t.view.map.remove(this.virtualLayer),this.virtualLayer=null,this.clearHighLight());var a=this.getLayerDataSource(),o=null==a?void 0:a.getSelectedRecords();if(o&&o.length>0){var s=a.layer,u=this.getObjectIdField(s.fields,s.objectIdField),l=[];for(i=0;i<o.length;i++){var d=o[i].feature.clone(),p=d.attributes[s.objectIdField];d.attributes={},d.attributes[s.objectIdField]=p,l.push(d)}c(["esri/layers/FeatureLayer"]).then((function(r){var n=r[0];e.virtualLayer=new n({title:s.title,source:l,fields:u?[u]:[],objectIdField:s.objectIdField,renderer:e.getRendererForVirtualLayer(l[0].geometry.type),listMode:"hide",legendEnabled:!1}),t.view.map.add(e.virtualLayer,e.layerIndex),e.virtualLayer.on("layerview-create",(function(t){var r=t.layerView;e.highLightHandle=r.highlight(l)}))}))}}},t.prototype.highLightFeatures=function(e){var t=this;this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null),this.view&&this.view.when((function(){t.highLightHandle&&(t.highLightHandle.remove(),t.highLightHandle=null),t.highLightHandle=t.view.highlight(e)}))},t.prototype.clearHighLight=function(){(this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null,this.isReservePopup&&(this.getViewForMap().popup.close(),this.isReservePopup=!1)),this.virtualLayer)&&(ye.getInstance().getJimuMapViewById(this.jimuMapViewId).view.map.remove(this.virtualLayer),this.virtualLayer=null)},t.prototype.selectFeatureById=function(e,t){var r;null===(r=this.getLayerDataSource())||void 0===r||r.selectRecordById(e,t),null==e?this.clearHighLight():this.highLightSelectedFeatures()},t.prototype.selectFeaturesByIds=function(e,t){var r;null===(r=this.getLayerDataSource())||void 0===r||r.selectRecordsByIds(e,t),e&&e.length>0?this.highLightSelectedFeatures():this.clearHighLight()},t.prototype.onAppModeInfoChange=function(e,t){var r;this.setRefreshIntervalForLayer(null===(r=this.getLayerDataSource())||void 0===r?void 0:r.getAutoRefreshInterval())},t.prototype.onLayerDataSourceInfoChange=function(e,t){var r,n,i,a;(null===(r=null==t?void 0:t.selectedIds)||void 0===r?void 0:r.length)>0||(null===(n=null==t?void 0:t.selectedIndexes)||void 0===n?void 0:n.length)>0?this.selectedIds!==t.selectedIds.join(",")&&(this.selectedIds=t.selectedIds.join(","),this.highLightSelectedFeatures()):(this.selectedIds="",this.clearHighLight()),(null===(i=this.getLayerDataSource())||void 0===i?void 0:i.getCurrentQueryParams())&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams()),this.view&&((null==t?void 0:t.gdbVersion)&&(this.layer.gdbVersion=t.gdbVersion),(null==t?void 0:t.gdbVersion)||(this.layer.gdbVersion=this.originalGdbVersion)),this.setRefreshIntervalForLayer(null===(a=this.getLayerDataSource())||void 0===a?void 0:a.getAutoRefreshInterval())},t.prototype.getViewForMap=function(){var e=ye.getInstance().getJimuMapViewById(this.jimuMapViewId);return e&&e.view},t.prototype.handleFeatureNavigationAtPopUp=function(e){var t=this.getLayerDataSource();this.isReservePopup=!0,null==t||t.selectRecordById(e)},t.prototype.moveFeatureToCenter=function(e){return we(this,void 0,void 0,(function(){var t=this;return me(this,(function(r){switch(r.label){case 0:return[4,this.doQueryById(e).then((function(r){return r||(t.getLayerDataSource()?t.getLayerDataSource().queryById(e).then((function(e){return e&&e.feature})):null)})).then((function(r){return we(t,void 0,void 0,(function(){var t;return me(this,(function(n){switch(n.label){case 0:return r?(t=this.getCenterPoint(r.geometry))?[4,this.getViewForMap().goTo(t)]:[3,2]:[3,5];case 1:return[2,n.sent()];case 2:return[4,Promise.reject("Does not find center point.")];case 3:return[2,n.sent()];case 4:return[3,7];case 5:return[4,Promise.reject("Dose not find feature."+e)];case 6:return[2,n.sent()];case 7:return[2]}}))}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.getCenterPoint=function(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}},t.prototype.getSelectedRecordIds=function(){var e=this;return Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId]?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds.asMutable():Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes?Object(o.getAppStore)().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes.asMutable().map((function(t){return e.features[t].attributes[e.getIdField()]})):[]:[]},t.prototype.getIdField=function(){var e=this.view.layer.objectIdField;if(!e){var t=this.view.layer.fields.find((function(e){return"oid"===e.type}));t&&(e=t.name)}return e||(e="OBJECTID"),e},t.prototype.getLayerDataSource=function(){return o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId)},t.prototype.selectRecordsByQuery=function(e){return we(this,void 0,void 0,(function(){var t=this;return me(this,(function(r){switch(r.label){case 0:return[4,c(["esri/layers/FeatureLayer"]).then((function(r){return we(t,void 0,void 0,(function(){var t,r,n,i,a,s,u=this;return me(this,(function(c){switch(c.label){case 0:for(t=ye.getInstance().getJimuMapViewById(this.jimuMapViewId),r=t.getParentLayerViews(this.id),n=!0,i=0;i<r.length;i++)if(!r[i].layer.visible){n=!1;break}return n&&this.layer.visible?[3,2]:[4,Promise.resolve([])];case 1:return[2,c.sent()];case 2:return this.virtualLayer&&(t.view.map.remove(this.virtualLayer),this.virtualLayer=null,this.clearHighLight()),a=this.getLayerDataSource(),e.geometry=e.geometry.toJSON?e.geometry.toJSON():e.geometry,(s=null==a?void 0:a.dataSourceManager.createLocalDataSource(a,"view"))&&s.layer?[4,s.load(e,{widgetId:"view"}).then((function(e){return we(u,void 0,void 0,(function(){var r,n,i,a;return me(this,(function(u){switch(u.label){case 0:if(!(e&&e.length>0))return[3,2];for(r=[],n=[],i=[],a=0;a<e.length;a++)r.push(e[a].getId()),n.push(e[a].feature),i.push(e[a]);return o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(t.mapWidgetId,i)),s.selectRecordsByIds(r),[4,Promise.resolve(n)];case 1:return[2,u.sent()];case 2:return[4,Promise.resolve([])];case 3:return[2,u.sent()]}}))}))}))]:[3,4];case 3:return[2,c.sent()];case 4:return[4,Promise.resolve([])];case 5:return[2,c.sent()]}}))}))}),(function(){return we(t,void 0,void 0,(function(){return me(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve([])];case 1:return[2,e.sent()]}}))}))})).then((function(e){return we(t,void 0,void 0,(function(){var t;return me(this,(function(r){switch(r.label){case 0:return(!e||e&&0===e.length)&&(null==(t=this.getLayerDataSource())||t.selectRecordsByIds([])),[4,Promise.resolve(e)];case 1:return[2,r.sent()]}}))}))}))];case 1:return[2,r.sent()]}}))}))},t.prototype.getObjectIdField=function(e,t){for(var r=null,n=0;n<e.length;n++)if(e[n].name===t)return r=e[n];return r},t.prototype.getRendererForVirtualLayer=function(e){return["point","multipoint"].includes(e)?{type:"simple",symbol:{type:"simple-marker",style:"circle",color:this.getViewForMap().highlightOptions.color,size:"16px",outline:{color:this.getViewForMap().highlightOptions.color,width:1}}}:["polyline"].includes(e)?{type:"simple",symbol:{type:"simple-line",color:this.getViewForMap().highlightOptions.color,width:1,style:"solid"}}:["polygon","extent"].includes(e)?{type:"simple",symbol:{type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:this.getViewForMap().highlightOptions.color,width:1}}}:["mesh"].includes(e)?{type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:this.getViewForMap().highlightOptions.color}}]}}:null},t}(N),be=function(){function e(){this.id="arcgis-dependency-define"}return e.prototype.getDependencyKey=function(){return"jimu-arcgis"},e.prototype.getResources=function(){var e;this.themeChangeObserver||(this.themeChangeObserver=Object(o.observeStore)(this.onThemeChange.bind(this),["theme"]));var t=window.jimuConfig.arcgisJsApiUrl;if(!Object(o.getAppStore)().getState().queryObject.apiurl||(t=Object(o.getAppStore)().getState().queryObject.apiurl,this.checkApiUrl(t))){/\/$/.test(t)||(t+="/"),window.jimuConfig.arcgisJsApiUrl=t,window.dojoConfig={baseUrl:o.urlUtils.getFixedRootPath(),parseOnLoad:!1,async:!0,tlmSiblingOfDojo:!1,has:{"esri-featurelayer-webgl":1,"dojo-sniff":0,"dojo-cdn":0},locale:window.locale},window.dojoConfig.packages=[{name:"dojo",location:t+"dojo"},{name:"dijit",location:t+"dijit"},{name:"dojox",location:t+"dojox"},{name:"dgrid",location:t+"dgrid"},{name:"esri",location:t+"esri"},{name:"moment",location:t+"moment"},{name:"whatwg-fetch",location:t+"whatwg-fetch",main:"dist/fetch.umd"}],/src\/$/.test(t)?window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:t+"node_modules/@dojo"},{name:"tslib",location:t+"node_modules/tslib",main:"tslib"},{name:"cldrjs",location:t+"node_modules/cldrjs",main:"dist/cldr"},{name:"globalize",location:t+"node_modules/globalize",main:"dist/globalize"},{name:"maquette",location:t+"node_modules/maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:t+"node_modules/maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:t+"node_modules/maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]):window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:t+"@dojo"},{name:"tslib",location:t+"tslib",main:"tslib"},{name:"cldrjs",location:t+"cldrjs",main:"dist/cldr"},{name:"globalize",location:t+"globalize",main:"dist/globalize"},{name:"maquette",location:t+"maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:t+"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:t+"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]);var r=[{url:t+"dojo/dojo.js"}];return(null===(e=Object(o.getAppStore)().getState().theme)||void 0===e?void 0:e.darkTheme)?r.push({url:this.getAPIThemeUrl(t,!0)}):r.push({url:this.getAPIThemeUrl(t,!1)}),[{url:"jimu-arcgis",dependencies:r}]}console.log("Bad apiurl.",t)},e.prototype.onThemeChange=function(e,t){e&&t&&(null==e?void 0:e.darkTheme)!==(null==t?void 0:t.darkTheme)&&(this.removeApiThemeStyle(this.getAPIThemeUrl(window.jimuConfig.arcgisJsApiUrl,e.darkTheme)),o.moduleLoader.loadModule(this.getAPIThemeUrl(window.jimuConfig.arcgisJsApiUrl,t.darkTheme)))},e.prototype.removeApiThemeStyle=function(e){var t;o.moduleLoader.deleteModule(e),null===(t=document.querySelector('link[href="'+e+'"]'))||void 0===t||t.remove()},e.prototype.getAPIThemeUrl=function(e,t){return t?e+"esri/themes/dark/main.css":e+"esri/css/main.css"},e.prototype.checkApiUrl=function(e){return"development"===window.env||(!/^\/\//.test(e)&&!/^https?:\/\//.test(e)||/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(e))},e}(),Le=function(){function e(){this.id="arcgis-ds-factory"}return e.prototype.getFactoryUri=function(e){if(Object.keys(Z.a).map((function(e){return Z.a[e]})).includes(e))return"jimu-arcgis/arcgis-data-source"},e}(),Se=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.viewManager=ye.getInstance(),t.onViewsCreate=function(e){t.props.onViewsCreate&&t.props.onViewsCreate(e)},t.onViewGroupCreate=function(){if(t.props.onViewGroupCreate&&t.viewManager&&t.props.useMapWidgetId){var e=t.viewManager.getJimuMapViewGroup(t.props.useMapWidgetId);t.props.onViewGroupCreate(e)}},t.onActiveViewChange=function(e){if(t.props.onActiveViewChange){var r=t.viewManager&&t.viewManager.getJimuMapViewById(t.getActiveViewId(t.props.useMapWidgetId,t.props.viewInfos))||null;t.props.onActiveViewChange(r,e)}},t.getActiveViewId=function(e,t){return t&&Object.keys(t).find((function(r){return t[r].mapWidgetId===e&&t[r].isActive}))},t.getWhetherAllViewsCreated=function(e,r){return void 0===e&&(e=[]),e.length>0&&!e.some((function(e){return!t.getWhetherViewCreated(e,r)}))},t.getWhetherViewCreated=function(e,t){return!!(e&&t&&t[e]&&t[e].status&&t[e].status===o.JimuMapViewStatus.Loaded)},t.getViewIdsFromMapWidgetId=function(e,t){return t?Object.keys(t).filter((function(r){return t[r].mapWidgetId===e})):[]},t.getViews=function(e){if(!e)return null;var r={};return e.forEach((function(e){r[e]=t.viewManager.getJimuMapViewById(e)})),r},t}return Se(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.useMapWidgetId,r=e.viewInfos,n=this.getViewIdsFromMapWidgetId(t,r);if(n.length>0&&this.onViewGroupCreate(),this.getWhetherAllViewsCreated(n,r)){var i=this.getViews(n);this.onViewsCreate(i)}var a=this.getActiveViewId(t,r);a&&this.getWhetherViewCreated(a,r)&&this.onActiveViewChange(null)},t.prototype.componentDidUpdate=function(e){var t=this.getViewIdsFromMapWidgetId(e.useMapWidgetId,e.viewInfos),r=this.getViewIdsFromMapWidgetId(this.props.useMapWidgetId,this.props.viewInfos);if(0===t.length&&r.length>0&&this.onViewGroupCreate(),!this.getWhetherAllViewsCreated(t,e.viewInfos)&&this.getWhetherAllViewsCreated(r,this.props.viewInfos)){var n=this.getViews(r);this.onViewsCreate(n)}this.getActiveViewId(e.useMapWidgetId,e.viewInfos)!==this.getActiveViewId(this.props.useMapWidgetId,this.props.viewInfos)&&this.onActiveViewChange(null)},t.prototype.render=function(){if(!this.props.useMapWidgetId||!this.props.viewInfos||!this.props.children)return null;var e=this.getViewIdsFromMapWidgetId(this.props.useMapWidgetId,this.props.viewInfos),t=this.getViews(e);return"function"==typeof this.props.children?this.props.children(t):this.props.children},t}(o.React.PureComponent),Ve=o.ReactRedux.connect((function(e,t){return e.appStateInBuilder?{viewInfos:e.appStateInBuilder&&e.appStateInBuilder.jimuMapViewsInfo}:{viewInfos:e&&e.jimuMapViewsInfo}}))(Me),je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xe=function(e){function t(t){var r=e.call(this,t)||this;return r.getJimuMapViewIdsFromUseMapWidgetIds=function(e,t,n){var i=[];return e&&e.forEach((function(e){i=i.concat(r.getJimuMapViewIdsFromMapWidgetId(e,t,n))})),i},r.getJimuMapViewIdsFromMapWidgetId=function(e,t,r){return r&&t?Object.keys(t).filter((function(n){return t[n].mapWidgetId===e&&t[n].datasourceId===r})):[]},r}return je(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId);if(t[0]&&this.props.viewInfos[t[0]].status===o.JimuMapViewStatus.Loaded&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId){var r=ye.getInstance().getJimuMapViewById(t[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);r?r.then((function(t){e.props.onLayerViewCreated&&e.props.onLayerViewCreated(t)}),(function(t){e.props.onLayerViewFailed&&e.props.onLayerViewFailed(t)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}t[0]&&this.props.viewInfos[t[0]].status===o.JimuMapViewStatus.Failed&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)},t.prototype.componentDidUpdate=function(e,t){var r=this,n=this.getJimuMapViewIdsFromUseMapWidgetIds(e.useMapWidgetIds,e.viewInfos,e.jimuLayerViewInfo&&e.jimuLayerViewInfo.rootDatasourceId),i=e.viewInfos[n[0]],a=i&&i.status,s=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId),u=this.props.viewInfos[s[0]],c=u&&u.status;if(a!==c||a===c&&n.join("")===s.join(""))if(u){if(u.status===o.JimuMapViewStatus.Loaded){var l=ye.getInstance().getJimuMapViewById(s[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);l?l.then((function(e){r.props.onLayerViewCreated&&r.props.onLayerViewCreated(e)}),(function(e){r.props.onLayerViewFailed&&r.props.onLayerViewFailed(e)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}u.status===o.JimuMapViewStatus.Failed&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)}else this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)},t.prototype.render=function(){return null},t}(o.React.PureComponent),Pe=o.ReactRedux.connect((function(e,t){return{viewInfos:e&&e.jimuMapViewsInfo}}))(xe),De=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},Fe=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function Oe(){return De(this,void 0,void 0,(function(){return Fe(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return[2,e.sent()]}}))}))}}]))}}}));